(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0d2ef4"],{"5b2c":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("nav",{staticClass:"vital-container cb"},[a("strong",{staticClass:"fl nav-title mt-10 f16"},[e._v("Roles")]),e._v(" "),a("div",{staticClass:"fr"},[a("el-input",{staticClass:"radius-input search-input mr-15",attrs:{size:"medium",clearable:"",placeholder:"Please enter the keyword"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.RolesaerchBtn(t)}},model:{value:e.searchData.name,callback:function(t){e.$set(e.searchData,"name",t)},expression:"searchData.name"}},[a("i",{staticClass:"el-input__icon el-icon-search cp",attrs:{slot:"suffix",title:"Search"},on:{click:e.RolesaerchBtn},slot:"suffix"})]),e._v(" "),a("el-button",{staticClass:"filter-item shadow",attrs:{type:"primary",size:"medium",icon:"el-icon-plus"},on:{click:e.addRoleBtn}},[e._v("Add")])],1)]),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],staticClass:"mt-20",staticStyle:{width:"100%"},attrs:{data:e.list,fit:"","highlight-current-row":""}},[a("el-table-column",{attrs:{align:"center",label:"No.",width:"80",type:"index"}}),e._v(" "),a("el-table-column",{attrs:{"min-width":"150px",label:"Name"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.name))])]}}])}),e._v(" "),a("el-table-column",{attrs:{align:"center",label:"Edit",width:"250px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("i",{staticClass:"iconfont el-icon-edit color-main cp mr-10",attrs:{title:"Edit"},on:{click:function(a){return a.stopPropagation(),e.changeUserBtn(t.row)}}}),e._v(" "),a("i",{staticClass:"iconfont icon-shanchu color-red cp",attrs:{title:"Delete"},on:{click:function(a){return a.stopPropagation(),e.delData(t.row)}}})]}}])})],1),e._v(" "),a("div",{staticClass:"tr mt-25"},[a("el-pagination",{attrs:{background:"","page-size":10,layout:"total, prev, pager, next, jumper",total:e.total},on:{"current-change":e.handleCurrentChange}})],1),e._v(" "),a("el-dialog",{attrs:{title:"查看用户",visible:e.viewUserDialog,width:"30%"},on:{"update:visible":function(t){e.viewUserDialog=t}}},[a("div",{staticClass:"mb-20"},[a("div",{staticClass:"cb"},[a("div",{staticClass:"fl w30 tr pr-10"},[e._v("\n          登录名：\n        ")]),e._v(" "),a("div",{staticClass:"fl w70 pl-25"},[e._v("\n          "+e._s(e.viewUserData.userLoginName)+"\n        ")])]),e._v(" "),a("div",{staticClass:"cb mt-30"},[a("div",{staticClass:"fl w30 tr pr-10"},[e._v("\n          用户名：\n        ")]),e._v(" "),a("div",{staticClass:"fl w70 pl-25"},[e._v("\n          "+e._s(e.viewUserData.name)+"\n        ")])]),e._v(" "),a("div",{staticClass:"cb mt-30"},[a("div",{staticClass:"fl w30 tr pr-10"},[e._v("\n          邮箱：\n        ")]),e._v(" "),a("div",{staticClass:"fl w70 pl-25"},[e._v("\n          "+e._s(e.viewUserData.userEmail?e.viewUserData.userEmail:"--")+"\n        ")])]),e._v(" "),a("div",{staticClass:"cb mt-30"},[a("div",{staticClass:"fl w30 tr pr-10"},[e._v("\n          手机：\n        ")]),e._v(" "),a("div",{staticClass:"fl w70 pl-25"},[e._v("\n          "+e._s(e.viewUserData.userPhone?e.viewUserData.userPhone:"--")+"\n        ")])]),e._v(" "),a("div",{staticClass:"cb mt-30"},[a("div",{staticClass:"fl w30 tr pr-10"},[e._v("\n          归属单位：\n        ")]),e._v(" "),a("div",{staticClass:"fl w70 pl-25"},[e._v("\n          "+e._s(e.viewUserData.belongUnit)+"\n        ")])]),e._v(" "),a("div",{staticClass:"cb mt-30"},[a("div",{staticClass:"fl w30 tr pr-10"},[e._v("\n          角色：\n        ")]),e._v(" "),a("div",{staticClass:"fl w70 pl-25"},[e._v("\n          "+e._s(e.viewUserData.userRoleNames)+"\n        ")])])]),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.dialogVisible=!1}}},[e._v("确 定")])],1)]),e._v(" "),a("el-dialog",{attrs:{visible:e.roleCreatNew,width:"55%"},on:{"update:visible":function(t){e.roleCreatNew=t}}},[a("span",{attrs:{slot:"title"},slot:"title"},[e._v(e._s(e.roleEidtStatus?"Edit Role":"Add Role"))]),e._v(" "),a("el-form",{ref:"addRole",attrs:{model:e.addRole,"label-width":"100px",rules:e.userRules}},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:22}},[a("el-form-item",{attrs:{label:"Role name:",prop:"name"}},[a("el-input",{attrs:{placeholder:"Please enter role name"},model:{value:e.addRole.name,callback:function(t){e.$set(e.addRole,"name",t)},expression:"addRole.name"}})],1)],1)],1),e._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{directives:[{name:"loading",rawName:"v-loading",value:e.rolesLoading,expression:"rolesLoading"}],attrs:{label:"Privileges:",prop:"privileges"}},[a("el-checkbox",{attrs:{indeterminate:e.isIndeterminateAdmin},on:{change:e.handleCheckAllChangeAdmin},model:{value:e.checkAllAdmin,callback:function(t){e.checkAllAdmin=t},expression:"checkAllAdmin"}},[e._v("Select All")]),e._v(" "),a("el-checkbox-group",{on:{change:e.handleCheckedAdminChange},model:{value:e.addRole.privilegesAdmin,callback:function(t){e.$set(e.addRole,"privilegesAdmin",t)},expression:"addRole.privilegesAdmin"}},e._l(e.rolesDataAdmin,(function(e,t){return a("el-checkbox",{key:t,attrs:{label:e.name}})})),1)],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{directives:[{name:"loading",rawName:"v-loading",value:e.rolesLoading,expression:"rolesLoading"}]},[a("el-checkbox",{attrs:{indeterminate:e.isIndeterminateNormal},on:{change:e.handleCheckAllChangeNormal},model:{value:e.checkAllNormal,callback:function(t){e.checkAllNormal=t},expression:"checkAllNormal"}},[e._v("Select All")]),e._v(" "),a("el-checkbox-group",{on:{change:e.handleCheckedNormalChange},model:{value:e.addRole.privilegesNormal,callback:function(t){e.$set(e.addRole,"privilegesNormal",t)},expression:"addRole.privilegesNormal"}},e._l(e.rolesDataNormal,(function(e,t){return a("el-checkbox",{key:t,attrs:{label:e.name}})})),1)],1)],1)],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticClass:"btn-orange shadow",attrs:{type:"primary"},on:{click:function(t){return e.saveUserBtn("addRole")}}},[a("i",{staticClass:"iconfont icon-save f14 mr-5"}),e._v("Save")]),e._v(" "),a("el-button",{staticClass:"btn-white shadow",on:{click:function(t){return e.resetForm("addRole")}}},[a("i",{staticClass:"iconfont icon-reset mr-5 f14"}),e._v("Reset")])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"花名册导入",visible:e.uploadExcelDialog,width:"40%"},on:{"update:visible":function(t){e.uploadExcelDialog=t}}},[a("div",{staticClass:"tc"},[a("div",{staticClass:"tl mb-10 mt-10 f16"},[e._v("请导入对应格式的Excel文件")]),e._v(" "),a("input",{ref:"excel-upload-input",attrs:{id:"excel-upload-input",type:"file",accept:".xlsx, .xls"},on:{change:e.handleClick}}),e._v(" "),a("div",{attrs:{id:"drop"},on:{drop:e.handleDrop,dragover:e.handleDragover,dragenter:e.handleDragover}},[e._v("\n        将文件拖到此处或点击上传\n        "),a("el-button",{staticStyle:{"margin-left":"15px"},attrs:{loading:e.loading,size:"mini",type:"success"},on:{click:e.handleUpload}},[e._v("\n          上传Excel")])],1)])])],1)},s=[],l=a("b775");function n(e){return Object(l["a"])({url:"api/roles/byName",method:"GET",params:e})}function o(e){return Object(l["a"])({url:"api/privileges",method:"GET",params:e})}function r(e){return Object(l["a"])({url:"api/roles/".concat(e),method:"delete"})}function c(e,t){return Object(l["a"])({url:"api/roles/".concat(e),method:"put",data:t})}function d(e){return Object(l["a"])({url:"api/roles",method:"ppst",data:e})}var u={name:"InlineEditTable",filters:{statusFilter:function(e){return"停用"==e?"danger":"启用"==e?"success":void 0}},data:function(){return{isIndeterminateAdmin:!1,isIndeterminateNormal:!1,checkAllAdmin:!1,checkAllNormal:!1,roleCreatNew:!1,roleEidtStatus:!1,uploadExcelDialog:!1,rolesLoading:!1,databaseShow:!1,rolesDataAdmin:[],rolesDataNormal:[],addRole:{name:"",privilegesAdmin:[],privilegesNormal:[]},rolesOptions:[],userRules:{name:[{required:!0,message:"Please enter name",trigger:"blur"}]},changeUser:{name:"",loginName:"",tel:"",department:"",email:"",roles:[],roleId:[],id:""},list:[],loading:!1,listLoading:!0,viewUserData:{},viewUserDialog:!1,page:0,total:0,searchData:{userLoginName:"",name:"",userRoleName:"",Rolestatus:""}}},created:function(){this.getList()},methods:{handleCheckedNormalChange:function(e){var t=e.length;this.checkAllNormal=t===this.rolesDataNormal.length,this.isIndeterminateNormal=t>0&&t<this.rolesDataNormal.length},handleCheckAllChangeNormal:function(e){this.addRole.privilegesNormal=e?this.rolesDataNormal.map((function(e){return e.name})):[],this.isIndeterminateNormal=!1},handleCheckedAdminChange:function(e){var t=e.length;this.checkAllAdmin=t===this.rolesDataAdmin.length,this.isIndeterminateAdmin=t>0&&t<this.rolesDataAdmin.length},handleCheckAllChangeAdmin:function(e){this.addRole.privilegesAdmin=e?this.rolesDataAdmin.map((function(e){return e.name})):[],this.isIndeterminateAdmin=!1},selectType:function(){"Local File"==this.addRole.value?this.databaseShow=!1:this.databaseShow=!0},uploadExcel:function(e){this.uploadExcelDialog=!0},changeUserBtn:function(e){this.roleEidtStatus=!0,this.roleCreatNew=!0,this.getRolesData(),this.addRole.name=e.name,this.addRole.id=e.id,this.addRole.privileges=e.privileges.map((function(e){return e.name}));var t=[],a=[],i=e.privileges;i.map((function(e){-1!=e.name.indexOf("Admin")?t.push(e.name):-1!=e.name.indexOf("Normal")&&a.push(e.name)})),this.addRole.privilegesAdmin=t,this.addRole.privilegesNormal=a},getRolesData:function(){var e=this;this.rolesLoading=!0;var t={page:0,size:1e3};o(t).then((function(t){if(200===t.code){e.rolesLoading=!1;var a=[],i=[],s=t.data.content;s.map((function(e){-1!==e.name.indexOf("Admin")?a.push(e):-1!==e.name.indexOf("Normal")&&i.push(e)})),e.rolesDataAdmin=a,e.rolesDataNormal=i}}))},delData:function(e){var t=this;this.$confirm("Are you sure you want to delete data?",{confirmButtonText:"Confirm",cancelButtonText:"Cancel",type:"warning"}).then((function(){r(e.id).then((function(e){200===e.code&&(t.$message({type:"success",message:"Delete success!"}),t.getList())}))})).catch((function(){}))},handleDrop:function(e){if(e.stopPropagation(),e.preventDefault(),!this.loading){var t=e.dataTransfer.files;if(1===t.length){var a=t[0];if(!this.isExcel(a))return this.$message.error("Only supports upload .xlsx, .xls, .csv suffix files"),!1;this.upload(a),e.stopPropagation(),e.preventDefault()}else this.$message.error("Only support uploading one file!")}},handleDragover:function(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy"},handleUpload:function(){document.getElementById("excel-upload-input").click()},handleClick:function(e){var t=e.target.files,a=t[0];a&&this.upload(a)},upload:function(e){this.$refs["excel-upload-input"].value=null,this.readerData(e)},RolesaerchBtn:function(){this.searchData.name=this.searchData.name?this.searchData.name.trim():null,this.searchData.userLoginName=this.searchData.userLoginName?this.searchData.userLoginName.trim():null,this.userPage=1,this.getList()},saveUserBtn:function(e){var t=this;this.$refs[e].validate((function(e){if(!e)return!1;var a=[];t.addRole.privilegesAdmin.map((function(e){t.rolesDataAdmin.map((function(t){e===t.name&&a.push(t)}))}));var i=[];t.addRole.privilegesNormal.map((function(e){t.rolesDataNormal.map((function(t){e===t.name&&i.push(t)}))}));var s=a.concat(i);if(0===s.length)t.$message({type:"error",message:"Please select a privilege."});else if(t.roleEidtStatus){var l={name:t.addRole.name,privileges:s,id:t.addRole.id};c(t.addRole.id,l).then((function(e){200===e.code&&(t.$message({type:"success",message:"Update success!"}),t.roleCreatNew=!1,t.resetForm("addRole"),t.getList())}))}else{var n={name:t.addRole.name,privileges:s};d(n).then((function(e){200===e.code&&(t.$message({type:"success",message:"Add success!"}),t.roleCreatNew=!1,t.resetForm("addRole"),t.getList())}))}}))},addRoleBtn:function(){this.roleCreatNew=!0,this.roleEidtStatus=!1,this.getRolesData(),this.resetForm("addRole"),this.addRole.name="",this.addRole.privilegesAdmin=[],this.addRole.privilegesNormal=[]},viewUserBtn:function(e){this.viewUserDialog=!0,this.viewUserData={belongUnit:e.belongUnit,userEmail:e.userEmail,userLoginName:e.userLoginName,name:e.name,userPassword:e.userPassword,userPhone:e.userPhone,userRoleNames:e.userRoleNames}},changeUserRole:function(e){var t=this;this.changeUser.roleId=[],e.forEach((function(e){t.rolesOptions.forEach((function(a){e==a.roleName&&t.changeUser.roleId.push(a.id)}))}))},handleCurrentChange:function(e){this.page=e-1,this.getList()},handleFilter:function(){this.getList()},getList:function(){var e=this;this.listLoading=!1,this.listLoading=!0;var t={page:this.page,size:10,name:this.searchData.name};n(t).then((function(t){200===t.code&&(e.list=t.data.content,e.listLoading=!1,e.total=t.data.totalElements)}))},cancelEdit:function(e){e.title=e.originalTitle,e.edit=!1,this.$message({message:"The title has been restored to the original value",type:"warning"})},confirmEdit:function(e){e.edit=!1,e.originalTitle=e.title,this.$message({message:"The title has been edited",type:"success"})},resetForm:function(e){this.$refs[e].resetFields(),this.addRole.privilegesAdmin=[],this.addRole.privilegesNormal=[]}}},m=u,h=a("4023"),p=Object(h["a"])(m,i,s,!1,null,"69cebebc",null);t["default"]=p.exports}}]);