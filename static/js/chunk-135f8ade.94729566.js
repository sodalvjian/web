(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-135f8ade"],{"0531":function(e,t,a){},"1ec6":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("search-header"),e._v(" "),a("search-result")],1)},s=[],i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-row",{attrs:{gutter:10}},[a("el-col",{staticClass:"tc",attrs:{span:4}},[a("div",{staticClass:"p20 bg-color-white radius5 search-header-content"},[a("div",{staticClass:"mt-15"},[a("strong",{staticClass:"f18"},[e._v(e._s("quick"===e.searchType?"Quick Search":"Advance Search"))])]),e._v(" "),a("div",{staticClass:"mt-40 mb-30"},[a("el-button",{attrs:{type:"primary",round:"",size:"mini",plain:""},on:{click:e.openAdvanceSearch}},[e._v(e._s("quick"===e.searchType?"Advance Search":"Quick Search"))])],1)])]),e._v(" "),a("el-col",{attrs:{span:20}},[a("el-form",{staticClass:"p20 bg-color-white radius5 search-header-content",attrs:{"label-position":"left","label-width":"100px",model:e.formData}},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:10}},[a("el-form-item",{attrs:{label:"Patient List:"}},["quick"===e.searchType?a("el-select",{staticClass:"w radius-input",attrs:{disabled:"advance"===e.searchType,loading:e.patientListLoading,filterable:"",remote:"",placeholder:"Please select patient list","remote-method":e.getPatientList},on:{change:e.selectPatientList},model:{value:e.formData.patientList,callback:function(t){e.$set(e.formData,"patientList",t)},expression:"formData.patientList"}},[a("el-option-group",{attrs:{label:"all"}},[a("el-option",{attrs:{label:"ALL System Patients",value:""}})],1),e._v(" "),e.patientsOptions.length>0?a("el-option-group",{attrs:{label:"Patients"}},e._l(e.patientsOptions,(function(e){return a("el-option",{key:e.value,attrs:{label:e.name,value:e.id}})})),1):e._e()],1):a("span",[e._v(e._s(e._f("emptyShow")(e.formData.patientList)))])],1)],1),e._v(" "),a("el-col",{attrs:{span:14}},[a("el-form-item",{attrs:{label:"Time period:"}},[a("el-row",[a("el-col",{attrs:{span:11}},["quick"===e.searchType?a("el-date-picker",{staticClass:"w radius-input",attrs:{disabled:"advance"===e.searchType,type:"date","picker-options":e.pickerOptionsStart,placeholder:"Begin time"},model:{value:e.formData.beginTime,callback:function(t){e.$set(e.formData,"beginTime",t)},expression:"formData.beginTime"}}):a("span",{staticClass:" w tc disinblock"},[e._v(e._s(e._f("emptyShow")(e.formData.beginTime)))])],1),e._v(" "),a("el-col",{staticClass:"tc",attrs:{span:2}},[e._v("\n                  ~\n                ")]),e._v(" "),a("el-col",{attrs:{span:11}},["quick"===e.searchType?a("el-date-picker",{staticClass:"w radius-input",attrs:{"picker-options":e.pickerOptionsEnd,disabled:"advance"===e.searchType,type:"date",placeholder:"End time"},model:{value:e.formData.endTime,callback:function(t){e.$set(e.formData,"endTime",t)},expression:"formData.endTime"}}):a("span",{staticClass:" w tc disinblock"},[e._v(e._s(e._f("emptyShow")(e.formData.endTime)))])],1)],1)],1)],1),e._v(" "),e.phenotypeList.length>0&&"quick"===e.searchType?a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:"Phenotype:"}},e._l(e.phenotypeList,(function(t,n){return a("el-tag",{key:n,staticClass:"mr-5",attrs:{size:"small",effect:"dark"}},[e._v(e._s(t.name))])})),1)],1):e._e(),e._v(" "),"quick"!==e.searchType?a("el-col",{staticClass:"cb",attrs:{span:24}},[a("strong",{staticClass:"fl color-main f15"},[a("i",{staticClass:"el-icon-info color-main mr-4 f17"}),e._v(" Query:")]),e._v(" "),a("el-button",{staticClass:"fr",attrs:{size:"small",type:"primary",round:""},on:{click:e.editAdvanceSearch}},[e._v("Edit")])],1):e._e(),e._v(" "),"quick"===e.searchType?a("el-col",{attrs:{span:24}},[a("el-row",[a("el-col",{attrs:{span:24}},[a("el-popover",{attrs:{placement:"bottom-start","popper-class":"search-popover",trigger:e.popvoerTriggerStatus?"click":"manual"},model:{value:e.searchVisible,callback:function(t){e.searchVisible=t},expression:"searchVisible"}},[e.historyStatus?a("el-row",{attrs:{gutter:20}},[a("el-col",{directives:[{name:"loading",rawName:"v-loading",value:e.historyLoading,expression:"historyLoading"}],staticClass:"pb-20",attrs:{span:24}},[a("strong",{staticClass:"f16 mb-10 ml-5"},[e._v("Search History")]),e._v(" "),a("ul",{staticClass:"w saerch-history-content"},[0===e.historyList.length?a("no-data",{staticClass:"pt-80 w tc"}):e._e(),e._v(" "),e._l(e.historyList,(function(t,n){return a("li",{key:n,staticClass:"search-history-item cp",on:{click:function(a){return e.openHistoryItem(t)}}},[a("el-tag",{staticClass:"mr-5",attrs:{size:"mini"}},[e._v(e._s("QUERY"===t.type?"Q":"ADV_QUERY"===t.type?"A":"P"))]),a("span",{domProps:{innerHTML:e._s(t.name)}})],1)}))],2)])],1):e._e(),e._v(" "),e.historyStatus?e._e():a("el-row",{attrs:{gutter:20}},[a("el-col",{directives:[{name:"loading",rawName:"v-loading",value:e.sunonymLoading,expression:"sunonymLoading"}],staticClass:"pb-20",attrs:{span:9}},[a("strong",{staticClass:"f16 mb-15"},[e._v("Synonym")]),e._v(" "),a("div",{staticClass:"search-condition-content"},[a("div",{staticClass:"search-synonym-content"},[0===e.sunonymData.length?a("no-data",{staticClass:"pt-50 w tc"}):e._e(),e._v(" "),e.sunonymData.length>0?a("el-checkbox",{attrs:{indeterminate:e.isIndeterminate},on:{change:e.selectAllSynonym},model:{value:e.allSynonym,callback:function(t){e.allSynonym=t},expression:"allSynonym"}},[a("strong",[e._v("All synonym")])]):e._e(),e._v(" "),e.sunonymData.length>0?a("el-checkbox-group",{staticClass:"mt-15",on:{change:e.selectItemSynonym},model:{value:e.checkList,callback:function(t){e.checkList=t},expression:"checkList"}},e._l(e.sunonymData,(function(e,t){return a("el-checkbox",{key:t,staticClass:"disblock mt-10",attrs:{label:e}})})),1):e._e()],1),e._v(" "),a("div",{staticClass:"search-sunonym-custom"},[a("el-input",{staticClass:"radius-textarea",attrs:{resize:"none",type:"textarea",rows:3,placeholder:"Please enter custom synonyms separated by enter"},model:{value:e.sunonymCustom,callback:function(t){e.sunonymCustom=t},expression:"sunonymCustom"}})],1)])]),e._v(" "),a("el-col",{directives:[{name:"loading",rawName:"v-loading",value:e.conceptsLoading,expression:"conceptsLoading"}],staticClass:"pl-20 pb-20",attrs:{span:15}},[a("div",[a("strong",{staticClass:"f16 mb-15 pl-10"},[e._v("Concept")]),e._v(" "),a("div",{staticClass:"search-condition-content search-concept-content"},[0===e.conceptData.length?a("no-data",{staticClass:"mt-50"}):e._e(),e._v(" "),0!==e.conceptData.length?a("el-row",{staticClass:"color-black",attrs:{gutter:15}},[a("el-col",{staticClass:"f14 fb",attrs:{span:16}},[e._v("\n                              concept name\n                            ")]),e._v(" "),a("el-col",{staticClass:"f1 fb",attrs:{span:5}},[e._v("\n                              Domain id\n                            ")]),e._v(" "),a("el-col",{staticClass:"tr f14 fb",attrs:{span:3}},[e._v("\n                              child\n                            ")])],1):e._e(),e._v(" "),e.conceptData.length>0?a("section",{directives:[{name:"infinite-scroll",rawName:"v-infinite-scroll",value:e.loadConcept,expression:"loadConcept"}],staticClass:"concept-ui",staticStyle:{overflow:"auto",height:"90%"},attrs:{"infinite-scroll-distance":10}},[a("el-tree",{ref:"conceptTree",attrs:{props:e.conseptsProps,"check-strictly":"","empty-text":"","node-key":"conceptId",data:e.conceptData,"expand-on-click-node":!1,load:e.loadNode,lazy:"","show-checkbox":""},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.node,s=t.data;return a("el-row",{staticClass:"custom-tree-node",attrs:{gutter:10}},[a("el-col",{staticClass:"fb f14",attrs:{span:16,title:n.label}},[a("div",{staticClass:" text-short"},[e._v("\n                                    "+e._s(n.label)+"\n                                  ")])]),e._v(" "),a("el-col",{staticClass:"f14",attrs:{span:5}},[a("div",{staticClass:" text-short"},[e._v("\n                                    "+e._s(s.domainId)+"\n                                  ")])]),e._v(" "),a("el-col",{staticClass:"tr",attrs:{span:3}},[a("el-checkbox",{model:{value:n.data.childChecked,callback:function(t){e.$set(n.data,"childChecked",t)},expression:"node.data.childChecked"}})],1)],1)}}],null,!1,4250820214)})],1):e._e()],1)])]),e._v(" "),a("el-col",{staticClass:"tc mt-15",attrs:{span:24}},[a("el-button",{attrs:{size:"small",round:""},on:{click:function(t){e.searchVisible=!1,e.historyShowStatus=!0}}},[e._v("Cancel")]),e._v(" "),a("el-button",{attrs:{size:"small",round:"",type:"primary"},on:{click:e.confirmSearchCondition}},[e._v("Confirm")])],1)],1),e._v(" "),a("span",{attrs:{slot:"reference"},slot:"reference"},[a("el-input",{staticClass:"search-input w",attrs:{round:"",placeholder:"Please enter the key word"},on:{focus:e.openSearchHistory},nativeOn:{keyup:function(t){return e.loadSearchContent(t)}},model:{value:e.formData.keyword,callback:function(t){e.$set(e.formData,"keyword",t)},expression:"formData.keyword"}},[a("span",{attrs:{slot:"prepend"},slot:"prepend"},e._l(e.searchConditionList,(function(t,n){return a("el-tag",{key:n,staticClass:"radius500 mr-5",attrs:{size:"small",closable:""},on:{click:function(a){return a.stopPropagation(),e.editTag(t,n)},close:function(a){return e.handleCloseTag(t,n)}}},[e._v(e._s(t.nestQuery.items[0].properties.text))])})),1),e._v(" "),a("el-button",{attrs:{slot:"append",type:"primary"},on:{click:function(t){return t.stopPropagation(),e.searchDataFunction(t)}},slot:"append"},[e._v("Search")])],1)],1)],1)],1)],1)],1):e._e(),e._v(" "),a("el-col",{staticClass:"mt-15",attrs:{span:24}},["quick"===e.searchType?a("strong",{staticClass:"color-main f15"},[a("i",{staticClass:"el-icon-info color-main mr-4 f17"}),e._v(" Query:"),a("span",{staticClass:"ml-10 color-8 query-string-content",domProps:{innerHTML:e._s(e.queryString)}})]):a("strong",{staticClass:"color-main f15"},[a("span",{staticClass:"color-8 query-string-content",domProps:{innerHTML:e._s(e.queryString)}})])])],1)],1)],1)],1),e._v(" "),a("advanced-search",{ref:"advancedSearchRef",attrs:{"advance-search-data":e.advanceSearchData},on:{getAdvancedSearchData:e.getAdvancedSearchData}})],1)},o=[],r=a("ef87"),c=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-dialog",{attrs:{title:"Advance Search","close-on-click-modal":!1,visible:e.advancedDialog,width:"80%"},on:{"update:visible":function(t){e.advancedDialog=t}}},[a("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.advanceLoading,expression:"advanceLoading"}],ref:"advancedSearchData",staticClass:"advance-form",attrs:{model:e.advancedSearchData,"label-width":"120px"}},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:"Time period:",prop:"userName"}},[a("el-row",[a("el-col",{attrs:{span:11}},[a("el-date-picker",{staticClass:"w radius-input",attrs:{type:"date","picker-options":e.pickerOptionsStart,placeholder:"Begin time"},model:{value:e.advancedSearchData.beginTime,callback:function(t){e.$set(e.advancedSearchData,"beginTime",t)},expression:"advancedSearchData.beginTime"}})],1),e._v(" "),a("el-col",{staticClass:"tc",attrs:{span:2}},[e._v("\n                ~\n              ")]),e._v(" "),a("el-col",{attrs:{span:11}},[a("el-date-picker",{staticClass:"w radius-input",attrs:{"picker-options":e.pickerOptionsEnd,type:"date",placeholder:"End time"},model:{value:e.advancedSearchData.endTime,callback:function(t){e.$set(e.advancedSearchData,"endTime",t)},expression:"advancedSearchData.endTime"}})],1)],1)],1)],1)],1),e._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:"Patient List:",prop:"patientList"}},[a("el-select",{staticClass:"w radius-input",attrs:{clearable:"",filterable:"",remote:"",loading:e.patientListLoading,"remote-method":e.getPatientList,placeholder:"Please select patient list"},on:{change:e.selectPatientLIst},model:{value:e.advancedSearchData.patientList,callback:function(t){e.$set(e.advancedSearchData,"patientList",t)},expression:"advancedSearchData.patientList"}},[a("el-option-group",{attrs:{label:"all"}},[a("el-option",{attrs:{label:"ALL System Patients",value:""}})],1),e._v(" "),a("el-option-group",{attrs:{label:"Patients"}},e._l(e.patientsOptions,(function(e){return a("el-option",{key:e.value,attrs:{label:e.name,value:e.id}})})),1)],1)],1)],1)],1),e._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:24}},[e.phenotypeList.length>0?a("el-form-item",{attrs:{label:"Phenotype:"}},e._l(e.phenotypeList,(function(t,n){return a("el-tag",{key:n,staticClass:"mr-5",attrs:{size:"small",effect:"dark"}},[e._v(e._s(t.name))])})),1):e._e(),e._v(" "),a("el-form-item",{staticStyle:{"word-break":"break-word"},attrs:{label:"Load existing phenotype:",prop:"phenotype"}},[a("el-select",{staticClass:"w radius-input mt-15",attrs:{clearable:"",loading:e.selectLoading,filterable:"",placeholder:"Please select phenotype"},on:{change:e.chosePhenotype},model:{value:e.advancedSearchData.phenotype,callback:function(t){e.$set(e.advancedSearchData,"phenotype",t)},expression:"advancedSearchData.phenotype"}},e._l(e.phenotypeOptions,(function(e){return a("el-option",{key:e.value,attrs:{label:e.name,value:e.id}})})),1)],1)],1)],1),e._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:"Search Criteria:",prop:"Search criteria"}},[e.advanceModelShow?a("vue-query-builder-plus",{attrs:{"max-depth":10,rules:e.queryBuilderRules},on:{"child-add-word":e.addWord},model:{value:e.queryBuilderData,callback:function(t){e.queryBuilderData=t},expression:"queryBuilderData"}}):e._e()],1)],1)],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary",round:"",loading:e.advanceLoading},on:{click:e.advancedSearchBtn}},[e._v("Search")]),e._v(" "),a("el-button",{attrs:{type:"info",round:""},on:{click:function(t){e.advancedDialog=!1}}},[e._v("Cancel")])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"Save Variables",visible:e.saveDialog,width:"45%"},on:{"update:visible":function(t){e.saveDialog=t}}},[a("el-form",{ref:"saveVairableData",attrs:{model:e.saveVairableData,"label-width":"130px"}},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:"Name:",prop:"name"}},[a("el-input",{model:{value:e.saveVairableData.name,callback:function(t){e.$set(e.saveVairableData,"name",t)},expression:"saveVairableData.name"}})],1)],1)],1),e._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:"Description:",prop:"description"}},[a("el-input",{model:{value:e.saveVairableData.description,callback:function(t){e.$set(e.saveVairableData,"description",t)},expression:"saveVairableData.description"}})],1)],1)],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"warning"},on:{click:e.saveVairableBtn}},[e._v("Save")]),e._v(" "),a("el-button",{attrs:{type:"info"},on:{click:function(t){e.saveDialog=!1}}},[e._v("Cancel")])],1)],1)],1)},l=[],d=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"query-builder form-inline"},[a("query-builder-group",{attrs:{index:0,query:e.query,"rule-types":e.ruleTypes,rules:e.mergedRules,"max-depth":e.maxDepth,depth:e.depth,type:"query-builder-group"},on:{"update:query":function(t){e.query=t},"child-add-word":e.addWord}})],1)},p=[],u=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"rules-group-container"},[a("div",{staticClass:"rules-group-header"},[e._m(0),e._v(" "),a("div",{staticClass:"btn-group pull-right group-actions"},[a("el-dropdown",{attrs:{trigger:"click"},on:{command:e.handleCommand}},[a("el-button",{staticClass:"el-dropdown-link",attrs:{disabled:e.limitClickAddSingle,round:"",size:"mini"}},[a("i",{staticClass:"el-icon-plus el-icon--left"}),e._v("Add Item\n        ")]),e._v(" "),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[a("el-dropdown-item",{attrs:{disabled:e.limitClickAddSingle,command:"Phrase"}},[e._v("Key Word")]),e._v(" "),a("el-dropdown-item",{attrs:{disabled:e.limitClickAddSingle,command:"Concept"}},[e._v("Concept")])],1)],1),e._v(" "),e.depth<e.maxDepth?a("el-button",{attrs:{size:"mini",type:"",round:"",disabled:e.limitClickAddGroup},on:{click:e.addGroup}},[a("i",{staticClass:"iconfont icon-xinzeng f12 mr-5"}),e._v("Add Group")]):e._e(),e._v(" "),e.depth>1?a("el-button",{attrs:{size:"mini",round:"",type:"danger"},on:{click:e.remove}},[a("i",{staticClass:"iconfont icon-shanchu f12"})]):e._e()],1),e._v(" "),!e.limitClickAddGroup&&e.query.items.length>0?a("div",{staticClass:"btn-group group-conditions"},[a("el-radio-group",{attrs:{size:"mini"},model:{value:e.query.nestedOp,callback:function(t){e.$set(e.query,"nestedOp",t)},expression:"query.nestedOp"}},[a("el-radio-button",{attrs:{label:"AND",disabled:!e.hasMultipleRule}},[e._v("AND")]),e._v(" "),a("el-radio-button",{attrs:{label:"OR",disabled:!e.hasMultipleRule}},[e._v("OR")])],1)],1):e._e()]),e._v(" "),a("div",{staticClass:"rules-group-body"},[a("div",{staticClass:"rules-list"},e._l(e.query.items,(function(t,n){return a(t.type,{key:n,tag:"component",attrs:{type:t.type,query:t.query,"rule-types":e.ruleTypes,rules:e.rules,index:n,"max-depth":e.maxDepth,depth:e.depth+1},on:{"update:query":function(a){return e.$set(t,"query",a)},"child-deletion-requested":e.removeChild}})})),1)])])},h=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"fl search-focus"},[a("span",{staticClass:"main-porint"})])}],m=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"rule-container"},[a("div",{staticClass:"rule-header pt-5"},[a("div",{staticClass:"rule-operator-container"},[a("el-select",{staticClass:"small-form-element radius-input",attrs:{size:"mini"},model:{value:e.query.selectedOperator,callback:function(t){e.$set(e.query,"selectedOperator",t)},expression:"query.selectedOperator"}},e._l(e.selectedRuleObj.operators,(function(e){return a("el-option",{key:e.value,attrs:{value:e.value,label:e.label}})})),1)],1),e._v(" "),a("div",{staticClass:"rule-filter-container"},["Concept"!=e.query.value.type?a("el-input",{staticClass:"mt-5 radius-input w",attrs:{size:"mini",readonly:"",placeholder:"please edit"},model:{value:e.query.value.properties.text,callback:function(t){e.$set(e.query.value.properties,"text",t)},expression:"query.value.properties.text"}},[a("template",{slot:"prepend"},[a("strong",[e._v(e._s(e._f("setAdvancedType")(e.commandType||e.query.value.type)))])])],2):e._e(),e._v(" "),"Concept"==e.query.value.type?a("el-input",{staticClass:"mt-5 radius-input",attrs:{size:"mini",readonly:"",placeholder:"please edit"},model:{value:e.conceptNameCom,callback:function(t){e.conceptNameCom=t},expression:"conceptNameCom"}},[a("template",{slot:"prepend"},[a("strong",[e._v("C")])])],2):e._e()],1),e._v(" "),a("div",{staticClass:"btn-group pull-right rule-actions"},[a("el-button",{attrs:{round:"",type:"primary",size:"mini"},on:{click:e.handleCommand}},[a("i",{staticClass:"el-icon-edit"})]),e._v(" "),a("el-button",{attrs:{size:"mini",type:"danger",round:""},on:{click:e.remove}},[a("i",{staticClass:"iconfont icon-shanchu f12"})])],1)]),e._v(" "),a("word-module",{ref:"wordChild",attrs:{"word-module-data":e.wordModuleData},on:{addWordBtn:e.addWordBtn}}),e._v(" "),a("concept-module",{ref:"conceptChild",attrs:{"segments-filter-options":e.segmentsFilterOptions,"relations-options":e.relationsOptions,"semantic-type-options":e.semanticTypeOptions,"concept-module-data":e.conceptModuleData},on:{addConceptBtn:e.addConceptBtn}})],1)},y=[],f=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-dialog",{attrs:{title:"Word","append-to-body":"",visible:e.wordDialog,width:"60%"},on:{"update:visible":function(t){e.wordDialog=t}}},[a("el-tabs",{on:{"tab-click":e.changeWord},model:{value:e.wordActive,callback:function(t){e.wordActive=t},expression:"wordActive"}},[a("el-tab-pane",{attrs:{label:"Find",name:"first"}},[a("el-form",{ref:"wordFindData",staticClass:"mt-20",attrs:{action:"javascript:void(0)",model:e.wordFindData,"label-width":"120px"}},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:22}},[a("el-form-item",{attrs:{label:"Text:",prop:"text"}},[a("el-input",{staticClass:"radius-input",attrs:{placeholder:"please enter"},nativeOn:{keyup:function(t){return e.loadSearchContent(t)}},model:{value:e.wordFindData.text,callback:function(t){e.$set(e.wordFindData,"text",t)},expression:"wordFindData.text"}}),e._v(" "),e.sunonymDataShow?a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.sunonymLoading,expression:"sunonymLoading"}],staticClass:"search-synonym-content mt-15"},[0===e.sunonymData.length?a("no-data",{staticClass:"pt-50 w tc"}):e._e(),e._v(" "),e.sunonymData.length>0?a("el-checkbox-group",{staticClass:"mt-20 word-sunonym-checkbox",model:{value:e.checkList,callback:function(t){e.checkList=t},expression:"checkList"}},e._l(e.sunonymData,(function(e,t){return a("el-checkbox",{key:t,staticClass:"disblock",attrs:{label:e}})})),1):e._e()],1):e._e(),e._v(" "),a("div",{staticClass:"search-sunonym-custom mt-15"},[a("el-input",{staticClass:"radius-textarea",attrs:{autosize:{minRows:3,maxRows:5},type:"textarea",rows:3,placeholder:"Please enter custom synonyms separated by enter"},model:{value:e.sunonymCustom,callback:function(t){e.sunonymCustom=t},expression:"sunonymCustom"}})],1)],1)],1)],1),e._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"Window:",prop:"window"}},[a("el-input-number",{staticClass:"w radius-input",attrs:{"controls-position":"right",size:"medium",min:-1,max:200},model:{value:e.wordFindData.window,callback:function(t){e.$set(e.wordFindData,"window",t)},expression:"wordFindData.window"}})],1)],1)],1),e._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:22}},[a("el-form-item",{attrs:{prop:"caseSensitive"}},[a("el-checkbox",{model:{value:e.wordFindData.caseSensitive,callback:function(t){e.$set(e.wordFindData,"caseSensitive",t)},expression:"wordFindData.caseSensitive"}},[e._v("Case sensitive")])],1)],1)],1),e._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:22}},[a("el-form-item",{attrs:{prop:"stemming"}},[a("el-checkbox",{model:{value:e.wordFindData.stemming,callback:function(t){e.$set(e.wordFindData,"stemming",t)},expression:"wordFindData.stemming"}},[e._v("Stemming")])],1)],1)],1)],1)],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{round:""},on:{click:function(t){e.wordDialog=!1}}},[e._v("Cancel")]),e._v(" "),a("el-button",{attrs:{round:"",type:"primary"},on:{click:e.addWordBtn}},[e._v("Confirm")])],1)],1)],1)},v=[],g=a("70cc"),D={name:"Word",props:["wordModuleData"],data:function(){return{wordDialog:!1,wordSearchCondition:{},wordFindData:{text:"",operator:"AND",synonym:"",caseSensitive:!1,stemming:!0,assertion:"",window:0},loading:!1,sunonymData:[],sunonymLoading:!1,sunonymDataShow:!1,checkList:[],sunonymCustom:"",wordOutputData:{title:"",inResult:!0,inDb:!0,value:"match",description:""},wordActive:"first"}},computed:{"wordModuleData.synonym":function(){return"111"}},watch:{wordModuleData:{handler:function(e,t){this.wordModuleData.properties&&(this.wordFindData.text=this.wordModuleData.properties.text,this.wordFindData.operator=this.wordModuleData.operator,this.wordFindData.synonym=this.wordModuleData.synonym,this.wordFindData.caseSensitive=this.wordModuleData.properties.caseSensitive,this.wordFindData.stemming=this.wordModuleData.properties.stemming,this.wordFindData.assertion=this.wordModuleData.properties.assertion,this.wordFindData.window=this.wordModuleData.properties.window,this.wordOutputData.title=this.wordModuleData.title,this.wordOutputData.inResult=this.wordModuleData.properties.inResult,this.wordOutputData.inDb=this.wordModuleData.properties.inDb,this.wordOutputData.value=this.wordModuleData.properties.value,this.wordOutputData.description=this.wordModuleData.description)},deep:!0,immediate:!0}},methods:{addWordBtn:function(){var e=this.sunonymCustom?this.sunonymCustom.split("\n"):[];this.checkList=this.checkList.concat(e),this.checkList=Object(r["d"])(this.checkList),this.wordFindData.synonym=this.checkList,this.$emit("addWordBtn")},openDialog:function(e){this.wordDialog=!0,this.sunonymCustom="",this.sunonymData=[],this.checkList=[],this.sunonymDataShow=!1,this.wordFindData.text="",e&&(this.wordSearchCondition=e,this.getSunonym(e.properties.text))},closeDialog:function(){this.wordDialog=!1},changeWord:function(){},loadSearchContent:function(){var e=this;this.wordFindData.text.trim()&&Object(r["a"])((function(){e.sunonymData=[],e.conceptsPage=0,e.checkList=[],e.sunonymCustom="",e.getSunonym()}),700)},remoteMethod:function(e){""!==e?(this.loading=!0,this.getSunonym(e)):this.options=[]},getSunonym:function(e){var t=this,a={key:e||this.wordFindData.text.trim()};this.sunonymDataShow=!0,this.sunonymLoading=!0,Object(g["d"])(a).then((function(a){if(a.data.length>0){var n=[];a.data[0].synonym.length>0&&(n=n.concat(a.data[0].synonym)),t.sunonymData=n}else t.sunonymData=[];if(t.sunonymLoading=!1,e){var s=[];e===t.wordSearchCondition.properties.text&&(t.checkList=t.wordSearchCondition.synonym),t.checkList.map((function(e){-1===t.sunonymData.indexOf(e)&&s.push(e)})),t.sunonymCustom=s.join("\n")}}))}}},b=D,C=(a("2839"),a("4023")),S=Object(C["a"])(b,f,v,!1,null,"084a871c",null),w=S.exports,L=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-dialog",{attrs:{title:"Concept","append-to-body":"",visible:e.conceptDialog,width:"72%"},on:{"update:visible":function(t){e.conceptDialog=t}}},[a("el-tabs",{on:{"tab-click":e.changeWord},model:{value:e.wordActive,callback:function(t){e.wordActive=t},expression:"wordActive"}},[a("el-tab-pane",{attrs:{label:"Find",name:"first"}},[a("el-form",{ref:"conceptFindData",staticClass:"mt-20",attrs:{model:e.conceptFindData,action:"javascript:void(0)","label-width":"150px"}},[a("el-row",{attrs:{gutter:24}},[a("el-col",{attrs:{span:22}},[a("el-form-item",{attrs:{label:"Concept:",prop:"name"}},[a("el-input",{staticClass:"input-with-select radius-input",attrs:{clearable:"",placeholder:"Please Enter"},nativeOn:{keyup:function(t){return e.saerchConcept(t)}},model:{value:e.selectConceptData.name,callback:function(t){e.$set(e.selectConceptData,"name",t)},expression:"selectConceptData.name"}}),e._v(" "),a("div",e._l(e.conceptFindData.concepts,(function(t,n){return a("el-tag",{key:n,staticClass:"radius500 mr-5 mb-10",attrs:{size:"small",closable:""},on:{close:function(t){return e.delConceptsItem(n)}}},[e._v(e._s(t.name))])})),1),e._v(" "),e.conceptDataShow?a("el-row",[a("el-col",{attrs:{span:24}},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.conceptsLoading,expression:"conceptsLoading"}],staticClass:"search-condition-content adv-search-concept-content"},[0===e.conceptData.length?a("no-data",{staticClass:"mt-80"}):e._e(),e._v(" "),0!==e.conceptData.length?a("el-row",{staticClass:"color-black",attrs:{gutter:10}},[a("el-col",{staticClass:"f14 fb",attrs:{span:16}},[e._v("\n                          Concept name\n                        ")]),e._v(" "),a("el-col",{staticClass:"f1 fb",attrs:{span:5}},[e._v("\n                          Domain id\n                        ")]),e._v(" "),a("el-col",{staticClass:"tr f14 fb concept-title-child",attrs:{span:3}},[e._v("\n                          child\n                        ")])],1):e._e(),e._v(" "),e.conceptData.length>0?a("section",{directives:[{name:"infinite-scroll",rawName:"v-infinite-scroll",value:e.loadConcept,expression:"loadConcept"}],staticClass:"concept-ui",staticStyle:{overflow:"auto",height:"90%"}},[a("el-tree",{ref:"conceptTree",attrs:{props:e.conseptsProps,"check-strictly":"","empty-text":"","node-key":"conceptId",data:e.conceptData,"expand-on-click-node":!1,load:e.loadNode,lazy:"","show-checkbox":""},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.node,s=t.data;return a("el-row",{staticClass:"custom-tree-node",attrs:{gutter:10}},[a("el-col",{staticClass:"fb f14",attrs:{span:16,title:n.label}},[a("div",{staticClass:" text-short"},[e._v(e._s(n.label))])]),e._v(" "),a("el-col",{staticClass:"f14",attrs:{span:5}},[e._v("\n                              "+e._s(s.domainId)+"\n                            ")]),e._v(" "),a("el-col",{staticClass:"tr",attrs:{span:3}},[a("el-checkbox",{model:{value:n.data.childChecked,callback:function(t){e.$set(n.data,"childChecked",t)},expression:"node.data.childChecked"}})],1)],1)}}],null,!1,4198621278)})],1):e._e()],1)])],1):e._e(),e._v(" "),e.conceptData.length>0?a("div",{staticClass:"tc mt-30"},[a("el-button",{attrs:{round:"",size:"small",type:"primary"},on:{click:e.saveConcepts}},[e._v("Confirm")])],1):e._e()],1)],1)],1),e._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:22}},[a("el-form-item",{attrs:{label:"Section:",prop:"firstName"}},[a("el-select",{staticClass:"w radius20-input",attrs:{filterable:"",multiple:"",placeholder:"pelase select"},model:{value:e.conceptFindData.segments,callback:function(t){e.$set(e.conceptFindData,"segments",t)},expression:"conceptFindData.segments"}},e._l(e.segmentsFilterOptions,(function(e,t){return a("el-option",{key:t,attrs:{label:e,value:e}})})),1),e._v(" "),a("div",{staticClass:"f12 color-8"},[e._v("\n                  If no segment is selected, all segments are searched by\n                  default.\n                ")])],1)],1)],1),e._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:22}},[a("el-form-item",{attrs:{label:"Confidence (%):",prop:"caseSensitive"}},[a("el-input-number",{staticClass:"radius-input",attrs:{min:1,max:100,"controls-position":"right",placeholder:"please enter"},model:{value:e.conceptFindData.confidence,callback:function(t){e.$set(e.conceptFindData,"confidence",t)},expression:"conceptFindData.confidence"}})],1)],1)],1),e._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:22}},[a("el-form-item",{attrs:{label:"Status:",prop:"negation"}},[a("el-radio-group",{model:{value:e.conceptFindData.assertion,callback:function(t){e.$set(e.conceptFindData,"assertion",t)},expression:"conceptFindData.assertion"}},[a("el-radio-button",{attrs:{label:""}},[e._v("Any")]),e._v(" "),a("el-radio-button",{attrs:{label:"absent",value:"absent"}},[e._v("Absent")]),e._v(" "),a("el-radio-button",{attrs:{label:"present"}},[e._v("Present")])],1)],1)],1)],1)],1)],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{round:""},on:{click:function(t){e.conceptDialog=!1}}},[e._v("Cancel")]),e._v(" "),a("el-button",{attrs:{round:"",type:"primary"},on:{click:e.addConceptBtn}},[e._v("Confirm")])],1)],1)],1)},_=[],k=a("b775");function O(e,t){return Object(k["a"])({url:"api/conceptSet/getAll/".concat(t,"/1000"),method:"POST",data:e})}var T={name:"Concept",filters:{setShowRel:function(e){return"".concat(e.key,":").concat(e.value)},setShowRelTitle:function(e){return"".concat(e.key," -> ").concat(e.value)}},props:["semanticTypeOptions","segmentsFilterOptions","relationsOptions","conceptModuleData"],data:function(){return{conceptDialog:!1,conceptsDialog:!1,conceptDataShow:!1,formLoading:!1,conceptSetLoading:!1,viewConceptDialog:!1,conceptId:"",selectConceptData:{name:""},treeBeginData:[],viewConceptData:[],relOptions:[],options:[],conceptspage:0,conceptsTotal:0,props:{label:"name",children:"zones",isLeaf:"leaf"},conceptFindData:{concepts:[],confidence:80,text:"",assertion:"",segments:[]},chosenConceptsOption:{page:0,pageSize:10,total:0},conceptOutputData:{description:"",extractRel:[],showRel:[],title:"",inResult:!1,inDb:!1,value:"match"},wordActive:"first",tableData:[],multipleSelection:[],conceptsPage:0,conceptsLoading:!1,conceptData:[],tagEdit:!1,conseptsProps:{label:"conceptName",value:"conceptId"}}},watch:{conceptModuleData:{handler:function(e,t){this.conceptModuleData.properties&&(this.conceptFindData.text=this.conceptModuleData.properties.text,this.conceptFindData.confidence=this.conceptModuleData.properties.confidence,this.conceptFindData.segments=this.conceptModuleData.segments,this.conceptFindData.assertion=this.conceptModuleData.properties.assertion,this.conceptFindData.concepts=this.conceptModuleData.concepts,this.conceptOutputData.description=this.conceptModuleData.description,this.conceptOutputData.extractRel=this.conceptModuleData.properties.extractRel?this.conceptModuleData.properties.extractRel:[],this.conceptOutputData.showRel=this.conceptModuleData.properties.showRel?this.conceptModuleData.properties.showRel:[],this.conceptOutputData.title=this.conceptModuleData.title,this.conceptOutputData.inResult=this.conceptModuleData.properties.inResult,this.conceptOutputData.inDb=this.conceptModuleData.properties.inDb,this.conceptOutputData.value=this.conceptModuleData.properties.value,this.conceptFindData.semType&&this.chngeSemType())},deep:!0,immediate:!0}},mounted:function(){},methods:{addConceptBtn:function(){this.$emit("addConceptBtn")},openDialog:function(e){this.conceptDialog=!0,this.conceptData=[],this.conceptDataShow=!1,this.selectConceptData.name=""},closeDialog:function(){this.conceptDialog=!1},loadNode:function(e,t){if(0===e.level)return t(this.conceptData);Object(g["a"])(e.data.conceptId).then((function(e){if(200===e.code){var a=e.data;if(!(a.res.length>0))return t([]);t(a.res)}}))},loadConcept:function(){this.conceptsPage++,this.getConcepts(this.selectConceptData.name||"")},getConcepts:function(e){var t=this,a={from:this.conceptsPage,size:20};this.conceptDataShow=!0,this.conceptsLoading=!0,Object(g["b"])(e||this.selectConceptData.name.trim(),a).then((function(a){var n=a.data.res;n.map((function(e){e.childChecked=!1,t.conceptData.push(e)})),t.conceptsLoading=!1,t.tagEdit&&t.searchConditionList.map((function(a){if(e===a.nestQuery.items[0].properties.text){var n=a.nestQuery.items[1].concepts;n.map((function(e){t.conceptData.map((function(t){e.code===t.concepts&&e.sonsFlag&&(t.childChecked=!0)}))})),t.$nextTick((function(){t.$refs.conceptTree.setCheckedKeys(n.map((function(e){return e.code})))}))}}))})).catch((function(){t.conceptsLoading=!1}))},showCheckbox:function(){},viewConcept:function(e){this.viewConceptDialog=!0,this.chosenConceptsOption.page=0,this.chosenConceptsOption.total=0,this.viewConceptData=[],this.getData(e.conceptSetId)},handleChosenConceptsChange:function(e){this.chosenConceptsOption.page=e-1,this.getData(this.conceptId)},getData:function(e){var t=this;this.formLoading=!0,this.conceptId=e,this.pubFun.httpRequest("get","api/conceptSet/".concat(e,"/").concat(this.chosenConceptsOption.page,"/").concat(this.chosenConceptsOption.pageSize),null,(function(e){t.formLoading=!1,t.chosenConceptsOption.total=e.total,t.viewConceptData=e.conceptSetsDetail,t.viewConceptData.map((function(e){"true"==e.childFlag?e.childFlag=!0:e.childFlag=!1}))}))},delConceptsItem:function(e){this.conceptFindData.concepts.splice(e,1)},saveConcepts:function(){var e=this,t=this.$refs.conceptTree.getCheckedNodes();t.length>0?(t.map((function(t){e.conceptFindData.concepts.push({sonsFlag:t.childChecked,sonLevel:1,code:t.conceptId,name:t.conceptName})})),this.selectConceptData.name="",this.conceptData=[],this.conceptDataShow=!1):this.$message.error("Please select concepts.")},saerchConcept:function(){var e=this;this.selectConceptData.name.trim()&&Object(r["a"])((function(){e.conceptData=[],e.conceptsPage=0,e.getConcepts()}),700)},getList:function(){var e=this,t={conceptSetId:this.selectConceptData.id,conceptSetName:this.selectConceptData.name};this.conceptSetLoading=!0,O(t,this.conceptspage).then((function(t){e.tableData=t.data.res,e.conceptstotal=t.data.total,e.conceptSetLoading=!1}))},searchCpnceptsBtn:function(){this.pubFun.httpRequest("get","api/vocabulary/search/".concat(this.selectConceptData.searchData),null,(function(e){}))},handleCurrentChange:function(e){this.multipleSelection=e},chngeSemType:function(){var e=this.relationsOptions[this.conceptFindData.semType]?Object.values(this.relationsOptions[this.conceptFindData.semType]):[],t=this.relationsOptions[this.conceptFindData.semType]?Object.keys(this.relationsOptions[this.conceptFindData.semType]):[],a=[];e[0]&&e[0].map((function(e){var n={key:t[0],value:e};a.push(n)})),this.relOptions=a},changeWord:function(){},handleNodeClick:function(e){},addConcepts:function(){this.conceptsDialog=!0,this.conceptData=[],this.selectConceptData.name=""},getUmlsData:function(){var e=this;this.pubFun.httpRequest("get","api/umls/chd/0",null,(function(t){e.treeBeginData=t}))}}},x=T,q=(a("34ac"),a("ba0e"),Object(C["a"])(x,L,_,!1,null,"cd9775fe",null)),P=q.exports,$={name:"QueryBuilderRule",components:{wordModule:w,conceptModule:P},filters:{setAdvancedType:function(e){switch(e){case"Phrase":return"W";case"phrase":return"W";case"word":return"W";case"Concept":return"C";case"ConceptSet":return"C";default:return"C"}}},props:["query","index","rules"],data:function(){return{wordModuleData:{},conceptModuleData:{},conceptDialog:!1,segmentsFilterOptions:[],relationsOptions:[],semanticTypeOptions:[],selectedRuleObj:this.rules[0],selectedRule:this.query.rule||this.rules[0].id,selectedSubRule:null,subRules:[],commandType:this.$store.state.commandType}},computed:{conceptNameCom:function(){var e=this.query.value.concepts.map((function(e){return e.name}));return e.join(",")}},mounted:function(){this.initValue();var e=this,t=e.selectedRule,a=t.indexOf("-");a>-1?(e.selectedRule=t.substring(0,a),e.selectedSubRule=t.substring(a+1),this.rules.forEach((function(t){if(t.id===e.selectedRule){var a=!1;if(e.subRules=t.subRules,t.subRules.forEach((function(t){if(t.id===e.selectedSubRule)return e.selectedRuleObj=t,a=!0,!1})),a)return!1}}))):this.rules.forEach((function(t){if(t.id===e.selectedRule)return e.selectedRuleObj=t,!1}))},methods:{handleCommand:function(){"Phrase"===this.commandType||"Phrase"===this.query.value.type?this.addWord():this.addConcept()},remove:function(){this.$emit("child-deletion-requested",this.index)},addWord:function(){var e=this.query.value;e.type?"Phrase"===e.type?(this.wordModuleData={properties:{text:e.properties.text,caseSensitive:e.properties.caseSensitive,stemming:e.properties.stemming,window:e.properties.window,assertion:e.properties.assertion,inResult:e.properties.inResult,inDb:e.properties.inDb,value:e.properties.value},operator:e.operator,synonym:e.synonym,title:e.title,description:e.description},this.$refs.wordChild.openDialog(this.wordModuleData)):this.$message.error("error in type!"):this.$refs.wordChild.openDialog()},addConcept:function(){var e=this.query.value;this.semanticTypeOptions=this.$store.state.conceptOptionData.entities,this.segmentsFilterOptions=this.$store.state.conceptOptionData.segments,this.relationsOptions=this.$store.state.conceptOptionData.relations,e.type?"Concept"===e.type||"ConceptSet"===e.type?(this.conceptModuleData={properties:{text:e.properties.text,confidence:e.properties.confidence,semType:e.properties.semType,assertion:e.properties.assertion,extractRel:e.properties.extractRel,showRel:e.properties.showRel,inResult:e.properties.inResult,inDb:e.properties.inDb,value:e.properties.value},segments:e.segments,concepts:e.concepts,synonym:e.synonym,title:e.title,description:e.description},this.$refs.conceptChild.openDialog(this.conceptModuleData)):this.$message.error("error in type!"):this.$refs.conceptChild.openDialog()},addWordBtn:function(){var e=this.$refs.wordChild.wordFindData,t=this.$refs.wordChild.wordOutputData,a={type:"Phrase",properties:{type:"Simple",text:e.text,caseSensitive:e.caseSensitive,stemming:e.stemming,inResult:t.inResult,inDb:t.inDb,value:t.extractedValue,assertion:e.assertion,window:e.window},synonym:e.synonym,operator:"AND",title:t.name,description:t.description},n=JSON.parse(JSON.stringify(a));this.query.value=n,this.$refs.wordChild.closeDialog()},addConceptBtn:function(){var e=this.$refs.conceptChild.conceptFindData,t=this.$refs.conceptChild.conceptOutputData,a={type:(e.concepts.length,"Concept"),concepts:e.concepts,description:t.description,operator:"AND",properties:{confidence:e.confidence,extractRel:t.extractRel,inDb:t.inDb,inResult:t.inResult,semType:e.semType,showRel:t.showRel,value:t.value,text:e.text,assertion:e.assertion,conceptSetId:0==e.concepts.length?"":e.concepts[0].conceptSetId},segments:e.segments,synonym:[],title:t.title},n=JSON.parse(JSON.stringify(a));this.query.value=n,this.$refs.conceptChild.closeDialog()},ruleChange:function(){var e=this;this.query.value=null,this.subRules=[],this.selectedSubRule=null,this.rules.forEach((function(t){t.id===e.selectedRule&&(void 0!==t.subRules&&null!==t.subRules&&t.subRules.length>0?e.subRules=t.subRules:(e.selectedRuleObj=t,e.query.rule=e.selectedRule,e.initValue()))})),this.query.selectedOperator=this.selectedRuleObj.operators[0].value},subRuleChange:function(){var e=this;this.query.value=null,this.subRules.forEach((function(t){t.id===e.selectedSubRule&&(e.selectedRuleObj=t,e.query.selectedOperator=e.selectedRuleObj.operators[0].value,e.query.rule=e.selectedRule+"-"+e.selectedSubRule,e.initValue())}))},initValue:function(){if(this.query.dateType=this.selectedRuleObj.dateType,null===this.query.value){var e=Object(r["b"])(this.query);"checkbox"===this.selectedRuleObj.inputType&&(e.value=[]),"select"!==this.selectedRuleObj.inputType&&"radio"!==this.selectedRuleObj.inputType||(e.value=this.selectedRuleObj.choices[0]),"time"!==this.selectedRuleObj.inputType&&"date"!==this.selectedRuleObj.inputType&&"datetime"!==this.selectedRuleObj.inputType||(e.value=Math.round(new Date)),this.$emit("update:query",Object(r["b"])(e))}}}},R=$,N=Object(C["a"])(R,m,y,!1,null,null,null),M=N.exports,j={name:"QueryBuilderGroup",components:{QueryBuilderRule:M},props:["ruleTypes","type","query","rules","index","maxDepth","depth"],data:function(){return{}},computed:{hasMultipleRule:function(){return this.query.items.length>1},limitClickAddSingle:function(){return this.query.items.length>0&&"query-builder-rule"!==this.query.items[0].type},limitClickAddGroup:function(){return this.query.items.length>0&&"query-builder-rule"===this.query.items[0].type}},methods:{handleCommand:function(e){var t=Object(r["b"])(this.query),a=this.$store.state.queryData;if(this.$store.state.commandType=e,0===a.items.length){t.items.push({type:"query-builder-group",query:{nestedOp:"AND",items:[],focus:!1}});var n={type:"query-builder-rule",query:{rule:this.rules[0].id,selectedOperator:this.rules[0].operators[0].value,value:{properties:{text:""},type:""}}};t.items[0].query.items.push(n)}else{var s={type:"query-builder-rule",query:{rule:this.rules[0].id,selectedOperator:this.rules[0].operators[0].value,value:{properties:{text:""},type:""}}};t.items.push(s)}t.commandType=e,this.$emit("update:query",t)},addRule:function(){var e=Object(r["b"])(this.query),t=this.$store.state.queryData;if(0===t.items.length){e.items.push({type:"query-builder-group",query:{nestedOp:"AND",items:[],focus:!1}});var a={type:"query-builder-rule",query:{rule:this.rules[0].id,selectedOperator:this.rules[0].operators[0].value,value:{properties:{text:""},type:""}}};e.items[0].query.items.push(a)}else{var n={type:"query-builder-rule",query:{rule:this.rules[0].id,selectedOperator:this.rules[0].operators[0].value,value:{properties:{text:""},type:""}}};e.items.push(n)}this.$emit("update:query",e),setTimeout((function(){}),200)},addGroup:function(){var e=Object(r["b"])(this.query);this.depth<this.maxDepth&&(e.items.push({type:"query-builder-group",query:{nestedOp:"AND",items:[],focus:!1}}),this.$emit("update:query",e))},remove:function(){this.$emit("child-deletion-requested",this.index)},removeChild:function(e){var t=Object(r["b"])(this.query);t.items.splice(e,1),this.$emit("update:query",t)}}},F=j,Q=(a("4710"),Object(C["a"])(F,u,h,!1,null,null,null)),I=Q.exports,A={name:"VueQueryBuilder",components:{QueryBuilderGroup:I},props:{maxDepth:{type:Number,default:3,validator:function(e){return e>=1}},value:Object},data:function(){return{depth:1,query:{nestedOp:"AND",items:[],focus:!1},rules:[{type:"normal",id:"word",label:"Word"},{type:"normal",id:"cpncept",label:"Cpncept"}],ruleTypes:{normal:{operators:[{label:"require",value:"AND"},{label:"not",value:"NOT"}],inputType:"text",id:"text-field",dataType:"string"}}}},computed:{mergedRules:function(){var e=[],t=this;return t.rules.forEach((function(a){if(void 0!==a.subRules){var n=[];a.subRules.forEach((function(e){"undefined"!==typeof t.ruleTypes[e.type]?n.push(Object.assign({},t.ruleTypes[e.type],e)):n.push(e)})),a.subRules=n}"undefined"!==typeof t.ruleTypes[a.type]?e.push(Object.assign({},t.ruleTypes[a.type],a)):e.push(a)})),e}},mounted:function(){var e=this;this.$store.state.queryData={items:[]},this.$watch("query",(function(t){e.$emit("input",Object(r["b"])(t)),e.$store.state.queryData=t}),{deep:!0}),"undefined"!==typeof this.$options.propsData.value&&(this.query=Object.assign(this.query,this.$options.propsData.value))},methods:{addWord:function(e){}}},Y=A,B=(a("6a28"),Object(C["a"])(Y,d,p,!1,null,null,null)),E=B.exports,z=a("b705"),V={};function W(e){e.forEach((function(e,t,a){if("query-builder-group"===e.type){e.nestQuery=Object(r["b"])(e.query),delete e.query;try{e.nestQuery.items&&"query-builder-rule"!==e.nestQuery.items[0].type&&(e.nestQuery.nestQuery=e.nestQuery.items,delete e.nestQuery.items,delete e.nestQuery.commandType),delete e.type,W(e.nestQuery.nestQuery||e.nestQuery.items)}catch(n){throw Object(z["Message"])({message:"Search criteria error, please check",center:!0,type:"warning"}),n}}else"query-builder-rule"===e.type&&(e.datatree=Object(r["b"])(e.query.value),e.datatree.operator=e.query.selectedOperator,a[t]=e.datatree,delete e.query,delete e.type)}))}function J(e){return V=Object(r["b"])(e),V.nestQuery=Object(r["b"])(e.items),delete V.items,delete V.commandType,W(V.nestQuery),V}var H={};function K(e){return H=Object(r["b"])(e),H.items=Object(r["b"])(e.nestQuery),delete H.nestQuery,H.items.map((function(e){e.query=e.nestQuery,e.type="query-builder-group",delete e.nestQuery,e.query.items.map((function(e,t,a){var n=Object(r["b"])(e);a[t]={},a[t].query=n,a[t].type="query-builder-rule";var s=Object(r["b"])(a[t].query);a[t].query={},a[t].query.value=s,a[t].query.rule="Phrase"===s.type?"word":"",a[t].query.selectedOperator=s.operator,a[t].query.value.type=s.type}))})),H}var U=a("6e6d"),G=new U["default"];function X(e){return Object(k["a"])({url:"api/phenoType/1/1000",method:"POST",data:e})}function Z(e){return Object(k["a"])({url:"api/search/meta",method:"POST",data:e})}function ee(e){return Object(k["a"])({url:"/api/patientList/".concat(e.id),method:"get"})}var te=a("de52"),ae=a.n(te),ne={components:{vueQueryBuilderPlus:E},filters:{setAdvancedType:function(e){switch(e){case"Word":return"W";case"Concept":return"C"}}},props:{advanceSearchData:{type:Object,required:!0}},data:function(){var e=this;return{pickerOptionsStart:{disabledDate:function(t){var a=e.advancedSearchData.endTime;if(a)return t.getTime()>=new Date(a).getTime()}},pickerOptionsEnd:{disabledDate:function(t){var a=e.advancedSearchData.beginTime;if(a)return t.getTime()<=new Date(a).getTime()-864e5}},group:"mission",saveDialog:!1,queryBuilderRules:[{type:"normal",id:"word",label:"Word"},{type:"normal",id:"cpncept",label:"Cpncept"}],saveVairableData:{name:"",description:""},patientsOptions:[],phenotypeOptions:[],phenotypeList:[],aaa:{},advanceModelShow:!1,queryBuilderData:{},advancedDataId:0,patientListLoading:!1,advancedDialog:!1,wordDialog:!1,selectLoading:!1,phraseDialog:!1,conceptDialog:!1,advanceLoading:!1,semanticTypeOptions:[],SegmentsFilterOptions:[],relationsOptions:[],advancedSearchData:{semanticType:"",timeRange:"",beginTime:"",endTime:"",patientId:"",patientList:"",patientListName:"",textType:[]},wordModuleData:[],wordModuleChange:{id:0,type:!1},conceptModuleChange:{id:0,type:!1},criteriaData:[],defaultProps:{children:"items",label:"label"},itemsData:[],groupCount:0,beforeData:{nestedOp:"OR",items:[{type:"query-builder-group",query:{nestedOp:"OR",items:[{type:"query-builder-rule",query:{rule:"word",selectedOperator:"OR",value:{type:"Phrase",properties:{type:"Simple",text:"cancer",caseSensitive:!1,stemming:!0,inResult:!0,inDb:!0,assertion:"",window:0},synonym:[],operator:"OR",description:""}}}],focus:!1}}],focus:!1}}},computed:{},watch:{advanceMetaData:function(){this.$store.state.conceptOptionData=this.advanceMetaData},$route:function(e,t){var a=this;"/"===e.path&&(G.$on("endSearch",(function(){a.advanceLoading=!1,a.advancedDialog=!1})),G.$on("advanceSearchError",(function(){a.advanceLoading=!1,a.$message.error("Search statement error, please check")})))}},mounted:function(){var e=this;G.$on("endSearch",(function(){e.advanceLoading=!1,e.advancedDialog=!1})),G.$on("advanceSearchError",(function(){e.advanceLoading=!1,e.$message.error("Search statement error, please check")}))},beforeDestroy:function(){G.$off("endSearch"),G.$off("advanceSearchError")},methods:{getPhenotype:function(e){var t=this,a={id:e};ee(a).then((function(e){200===e.code?(t.phenotypeList=e.data.phenoTypes?e.data.phenoTypes:[],e.data.phenoTypes):t.$message.error(e.message)}))},selectPatientLIst:function(){var e=this;if(this.advancedSearchData.patientList){var t={};t=this.patientsOptions.find((function(t){return t.id===e.advancedSearchData.patientList})),this.advancedSearchData.patientListName=t.name;var a=this.advancedSearchData.patientList;a&&this.getPhenotype(a)}else this.phenotypeList=[]},setTimeOptions:function(){var e=this;this.pickerOptionsStart={disabledDate:function(t){var a=e.advancedSearchData.endTime;if(a)return t.getTime()>new Date(a).getTime()}},this.pickerOptionsEnd={disabledDate:function(t){var a=e.advancedSearchData.beginTime;if(a)return t.getTime()<=new Date(a).getTime()-864e5}}},openAdvancedSearch:function(e,t,a){var n=this;"new"===e?(this.queryBuilderData={},Object.assign(this.$data,this.$options.data())):"edit"===e?(this.advanceModelShow=!1,this.$store.state.commandType=""):(this.advanceModelShow=!1,this.$store.state.commandType="",this.phenotypeList=[],this.advancedSearchData.patientList=""),this.setTimeOptions(),this.advancedDialog=!0,this.getPatientList(),this.getPhenotypeList(),this.getMetaData(),this.$nextTick((function(){n.advanceModelShow=!0,"new"!==e&&(n.queryBuilderData=t||n.advanceSearchData.query,n.advancedSearchData.beginTime=a?a.sdate:n.advanceSearchData.sdate,n.advancedSearchData.endTime=a?a.edate:n.advanceSearchData.edate)}))},getMetaData:function(){var e=this,t={};Z(t).then((function(t){200===t.code&&(e.advanceMetaData=t.data,e.$store.state.conceptOptionData=e.advanceMetaData)}))},chosePhenotype:function(){var e=this;if(this.advancedSearchData.phenotype){this.queryBuilderData={},this.advanceModelShow=!1;var t=this.phenotypeOptions.filter((function(t){return t.id===e.advancedSearchData.phenotype})),a=JSON.parse(t[0].frontQuery).query||JSON.parse(t[0].frontQuery);this.advancedSearchData.beginTime=JSON.parse(t[0].frontQuery).sdate,this.advancedSearchData.endTime=JSON.parse(t[0].frontQuery).edate;var n=K(a);this.$nextTick((function(){e.queryBuilderData=n,e.advanceModelShow=!0}))}else this.advanceModelShow=!1,this.queryBuilderData={},this.$nextTick((function(){e.advanceModelShow=!0}))},getPhenotypeList:function(){var e=this,t={};this.selectLoading=!0,X(t).then((function(t){200===t.code?(e.phenotypeOptions=t.data.content,e.selectLoading=!1):(e.$message.error(t.message),e.selectLoading=!1)}))},getPatientList:function(e){var t=this,a={name:e},n={page:1,size:10};this.patientListLoading=!0,Object(g["c"])(a,n).then((function(e){200===e.code?(t.patientsOptions=e.data.content,t.patientListLoading=!1):(t.$message.error(e.message),t.patientListLoading=!1)}))},saveVairableBtn:function(){var e=this,t={date:"",description:this.saveVairableData.description,disabled:!1,frontQuery:JSON.stringify(this.queryBuilderData),groupId:0,id:0,name:this.saveVairableData.name,query:JSON.stringify(J(this.queryBuilderData)),uid:"0",userId:0};this.pubFun.httpRequest("post","api/variable",t,(function(t){e.saveDialog=!1,e.$message.success("Success!")}))},advancedSearchBtn:function(){if(this.advancedSearchData.patientList&&!this.queryBuilderData.items){var e={sdate:this.advancedSearchData.beginTime?ae()(this.advancedSearchData.beginTime).format("YYYY-MM-DD"):"",edate:this.advancedSearchData.endTime?ae()(this.advancedSearchData.endTime).format("YYYY-MM-DD"):"",patientid:this.advancedSearchData.patientList,patientListName:this.advancedSearchData.patientListName,query:[]};return this.advanceLoading=!0,this.$emit("getAdvancedSearchData",e,this.queryBuilderData),!1}if(this.queryBuilderData.items)if(this.queryBuilderData.items[0].type){var t={sdate:this.advancedSearchData.beginTime?ae()(this.advancedSearchData.beginTime).format("YYYY-MM-DD"):"",edate:this.advancedSearchData.endTime?ae()(this.advancedSearchData.endTime).format("YYYY-MM-DD"):"",patientid:this.advancedSearchData.patientList,patientListName:this.advancedSearchData.patientListName,query:J(this.queryBuilderData)};this.advanceLoading=!0,this.$emit("getAdvancedSearchData",t,this.queryBuilderData)}else this.$message.warning("Search criteria content is empty");else this.$message.warning("Please enter search criteria")},completeLoading:function(){this.advanceLoading=!1},saveAdvancedSearchBtn:function(){this.saveVairableData.name="",this.saveVairableData.description="",this.saveDialog=!0},editItem:function(e){this.wordDialog=!0,this.wordModuleData=e,this.wordModuleChange.type=!0,this.wordModuleChange.id=e.id,this.wordModuleData.randomNumber=Math.random()},closeAdvancedSearch:function(){this.advancedDialog=!1,this.advanceLoading=!1},addWordBtn:function(){var e=this.$refs.wordChild.wordFindData,t=this.$refs.wordChild.wordOutputData,a={type:"Word",id:this.wordModuleChange.type?this.wordModuleChange.id:this.advancedDataId,properties:{type:"Simple",text:e.text,caseSensitive:e.caseSensitive,stemming:e.stemming,inResult:t.inResult,inDb:t.inDb,value:t.extractedValue,assertion:e.assertion},synonym:e.synonym?e.synonym.split(","):[],operator:"AND",title:t.name,description:t.description},n=JSON.parse(JSON.stringify(a));if(this.wordModuleChange.type){for(var s=JSON.parse(JSON.stringify(this.criteriaData)),i=0;i<s.length;i++)s[i].id===this.wordModuleChange.id&&(s[i]=n);this.criteriaData=s}else this.criteriaData.push(n),this.advancedDataId++;this.wordDialog=!1},addConceptBtn:function(){var e=this.$refs.conceptChild.conceptFindData,t=this.$refs.conceptChild.conceptOutputData,a={type:"Concept",id:this.conceptModuleChange.type?this.conceptModuleChange.id:this.advancedDataId,concepts:e.concepts,description:t.description,operator:"AND",properties:{confidence:e.confidence,extractRel:t.extractRel,inDb:t.inDb,inResult:t.inResult,semType:e.semType,showRel:t.showRel,value:t.value,text:e.text,assertion:e.assertion},segments:e.segments,synonym:[],title:t.name},n=JSON.parse(JSON.stringify(a));if(this.conceptModuleChange.type){for(var s=JSON.parse(JSON.stringify(this.criteriaData)),i=0;i<s.length;i++)s[i].id===this.conceptModuleChange.id&&(s[i]=n);this.criteriaData=s}else this.criteriaData.push(n),this.advancedDataId++;this.conceptDialog=!1},addWord:function(){this.wordDialog=!0,this.wordModuleChange.type=!1},addPhrase:function(){this.phraseDialog=!0},addConcept:function(){this.conceptDialog=!0,this.conceptModuleChange.type=!1}}},se=ne,ie=Object(C["a"])(se,c,l,!1,null,null,null),oe=ie.exports;function re(e){return Object(k["a"])({url:"/api/patientList/".concat(e.id),method:"get"})}function ce(e){return Object(k["a"])({url:"api/search/searchNaming",method:"post",data:e})}function le(e){return Object(k["a"])({url:"api/search/phenotypeSearchNaming",method:"post",data:e})}function de(){return Object(k["a"])({url:"api/queries/history?page=1&size=20&queryType=QUERY&queryType=ADV_QUERY",method:"get"})}function pe(){return Object(k["a"])({url:"api/queries/history?queryType=QUERY&patientIdFlag=true",method:"get"})}function ue(e){return Object(k["a"])({url:"api/queries/history",method:"POST",data:e})}var he={name:"SearchHeader",components:{advancedSearch:oe},props:{},data:function(){var e=this;return{pickerOptionsStart:{disabledDate:function(t){var a=e.formData.endTime;if(a)return t.getTime()>new Date(a).getTime()}},pickerOptionsEnd:{disabledDate:function(t){var a=e.formData.beginTime;if(a)return t.getTime()<=new Date(a).getTime()-864e5}},formData:{keyword:"",patientList:"",timeRange:"",beginTime:"",endTime:""},searchType:"quick",queryString:"",allSynonym:!1,isIndeterminate:!1,tagEdit:!1,tagIndex:0,conseptsProps:{label:"conceptName",value:"conceptId"},patientListLoading:!1,patientSize:10,patientListTagId:"",searchKeyword:"",saveKeyword:"",sunonymLoading:!1,conceptsLoading:!1,historyLoading:!1,conceptsPage:0,sunonymData:[],conceptData:[],conseptCheckList:[],searchConditionList:[],searchVisible:!1,checkList:[],patientsOptions:[],phenotypeList:[],historyStatus:!1,historyShowStatus:!0,popvoerTriggerStatus:!1,historyList:[],operationList:[],advanceSearchQuery:"",advanceSearchOriginalQuery:{},sunonymCustom:"",advanceSearchData:{}}},computed:{},watch:{searchVisible:function(e){e||(this.popvoerTriggerStatus=!1)}},created:function(){},mounted:function(){var e=this;this.getPatientList(),G.$on("refreshPatientList",(function(){e.getPatientList()}))},beforeDestroy:function(){G.$off("refreshPatientList")},methods:{remotePatientMethod:function(){},selectAllSynonym:function(e){this.checkList=e?this.sunonymData:[],this.isIndeterminate=!1},selectItemSynonym:function(e){var t=e.length;this.allSynonym=t===this.sunonymData.length,this.isIndeterminate=t>0&&t<this.sunonymData.length},openHistoryItem:function(e){if("QUERY"===e.type){var t=JSON.parse(e.query);localStorage.historyQueryId=e.id,this.patientListTagId=e.patientListId,this.formData.beginTime=t.sdate||"",this.formData.endTime=t.edate||"",this.searchConditionList=t.query?t.query.nestQuery:t.nestQuery,this.getSearchQueryText("QUERY"===e.type?"search":"phenotype",t.query?t.query.nestQuery:t.nestQuery)}else"ADV_QUERY"===e.type&&(this.advanceSearchData=JSON.parse(e.query),this.$refs.advancedSearchRef.openAdvancedSearch())},openSearchHistory:function(){this.historyShowStatus&&(this.searchVisible=!0,this.historyStatus=!0,this.popvoerTriggerStatus=!0,this.getHistoryList())},getOperationList:function(){var e=this;pe().then((function(t){200===t.code?e.operationList=t.data.content:e.$message.error(t.message)}))},getHistoryList:function(){var e=this;this.historyLoading=!0,de().then((function(t){200===t.code?(e.historyList=t.data.content,e.historyLoading=!1):e.$message.error(t.message)}))},loadNode:function(e,t){if(0===e.level)return t(this.conceptData);Object(g["a"])(e.data.conceptId).then((function(e){if(200===e.code){var a=e.data;if(!(a.res.length>0))return t([]);t(a.res)}}))},selectPatientList:function(){var e=this.formData.patientList;this.phenotypeList=[],e?this.getPhenotype(e):(this.phenotypeList=[],this.getSearchQueryText("search",this.searchConditionList))},getPhenotype:function(e){var t=this,a={id:e};re(a).then((function(e){200===e.code?(t.phenotypeList=e.data.phenoTypes?e.data.phenoTypes:[],e.data.phenoTypes,t.getSearchQueryText("phenotype")):t.$message.error(e.message)}))},editTag:function(e,t){this.searchVisible=!0,this.historyStatus=!1,this.tagEdit=!0,this.tagIndex=t,this.conceptData=[],this.allSynonym=!1,this.sunonymData=[],this.checkList=[],this.searchKeyword=e.nestQuery.items[0].properties.text,this.getSunonym(this.searchKeyword),this.getConcepts(this.searchKeyword)},handleCloseTag:function(e,t){this.searchConditionList.splice(t,1),this.formData.patientList?this.getSearchQueryText("phenotype",this.searchConditionList):this.getSearchQueryText("search",this.searchConditionList)},getAdvancedSearchData:function(e,t){var a=this;if(this.formData.beginTime=e.sdate,this.formData.endTime=e.edate,this.formData.patientList=e.patientListName,this.formData.patientid=e.patientid,this.searchType="advance",this.advanceSearchQuery=e,this.advanceSearchOriginalQuery=t,e.patientid){var n={page:0,size:100,query:e.query,sdate:e.sdate,edate:e.edate,patientListId:e.patientid,patientListName:e.patientListName,highlightFlag:!1,patientPage:2,patientSize:10,type:"advance"};0===this.searchConditionList.length&&delete e.query,this.getSearchQueryText("advancePhenotype",n),G.$emit("searchPhenoTypeFunction",n)}else this.getSearchQueryText("advanceSearch",e,(function(){G.$emit("searchFunction",e),a.addHistoryData(t,"ADV_QUERY")}))},addHistoryData:function(e,t){var a=this,n=this.formData.beginTime?ae()(this.formData.beginTime).format("YYYY-MM-DD"):"",s=this.formData.endTime?ae()(this.formData.endTime).format("YYYY-MM-DD"):"",i={type:t,name:this.setStringLength(this.queryString,120),query:{query:"QUERY"===t?e.query:"ADV_QUERY"===t?e:"",sdate:n,edate:s,patientid:this.formData.patientid}};i.name&&ue(i).then((function(e){200!==e.code&&a.$message.error(e.message)}))},setStringLength:function(e,t){e=e.replace(/(\<span class='NOT'>|\<span class='concept'>|\<span class='AND'>|\<span class='OR'>|\<\/span>)/g,(function(e,t){return{"<span class='NOT'>":"","<span class='concept'>":"","<span class='AND'>":"","<span class='OR'>":"","</span>":""}[t]}));var a="";return e.length>t?(a=e.substring(0,t),a+="..."):a=e,a},searchDataFunction:function(){var e=this,t=this.formData.beginTime?ae()(this.formData.beginTime).format("YYYY-MM-DD"):"",a=this.formData.endTime?ae()(this.formData.endTime).format("YYYY-MM-DD"):"";if(this.formData.patientList){var n=this.patientsOptions.find((function(t){return t.id===e.formData.patientList})).name,s={page:0,size:100,query:{nestedOp:"OR",name:this.saveKeyword,focus:!1,nestQuery:this.searchConditionList},sdate:t,edate:a,patientListId:this.formData.patientList,patientListName:n,highlightFlag:!1,patientPage:2,patientSize:10};0===this.searchConditionList.length&&delete s.query,G.$emit("searchPhenoTypeFunction",s)}else if(this.searchConditionList.length>0){var i={page:0,size:100,patientSize:this.patientSize,query:{nestedOp:"OR",focus:!1,nestQuery:this.searchConditionList},sdate:t,edate:a};this.patientListTagId&&(i.patientListTagId=this.patientListTagId),G.$emit("searchFunction",i),this.addHistoryData(i,"QUERY")}else this.$message.warning("Please enter the key word")},getSearchQueryText:function(e,t,a){var n=this,s=this.formData.beginTime?ae()(this.formData.beginTime).format("YYYY-MM-DD"):"",i=this.formData.endTime?ae()(this.formData.endTime).format("YYYY-MM-DD"):"",o={};"search"===e?o={size:10,query:{nestedOp:"OR",focus:!1,nestQuery:t},sdate:"",edate:""}:"phenotype"===e?o={highlightFlag:!1,page:0,patientListId:this.formData.patientList,patientPage:1,query:{nestedOp:"OR",name:this.saveKeyword,focus:!1,nestQuery:this.searchConditionList},sdate:s,edate:i,patientSize:10,size:100}:"advancePhenotype"===e?o={highlightFlag:!1,page:0,patientListId:this.formData.patientid,patientPage:1,query:{nestedOp:"OR",name:this.saveKeyword,focus:!1,nestQuery:t.query},sdate:s,edate:i,patientSize:10,size:100}:"advanceSearch"===e&&(o=t);var r="search"===e||"advanceSearch"===e?ce:le;r(o).then((function(e){if(200===e.code){var t=e.data;n.queryString=t,a()}else n.$message.error(e.message)})).catch((function(t){"advanceSearch"===e&&G.$emit("advanceSearchError",t)}))},confirmSearchCondition:function(){this.patientListTagId="";var e=this.$refs.conceptTree?this.$refs.conceptTree.getCheckedNodes():[],t=[];e.map((function(e){t.push({sonsFlag:e.childChecked,sonLevel:1,code:e.conceptId,name:e.conceptName})}));var a=this.sunonymCustom?this.sunonymCustom.split("\n"):[];this.checkList=this.checkList.concat(a);var n={nestQuery:{nestedOp:"OR",items:[{type:"Phrase",properties:{type:"Simple",text:this.tagEdit?this.searchKeyword:this.formData.keyword.trim(),caseSensitive:!1,stemming:!0,inResult:!0,inDb:!0,assertion:"",window:0},synonym:this.checkList,operator:"OR",description:""},{type:"Concept",concepts:t,description:"",operator:"OR",properties:{confidence:"90",extractRel:[],inDb:!1,inResult:!1,semType:"",showRel:[],value:"",text:"",assertion:"",conceptSetId:""},segments:[],synonym:[],title:""}],focus:!1}};0===t.length&&n.nestQuery.items.splice(1,1),this.tagEdit?this.searchConditionList[this.tagIndex]=n:(this.searchConditionList.push(n),this.saveKeyword=this.formData.keyword.trim(),this.formData.keyword=""),this.searchVisible=!1,this.phenotypeList.length>0?this.getSearchQueryText("phenotype",this.searchConditionList):this.getSearchQueryText("search",this.searchConditionList),this.historyShowStatus=!0},loadConcept:function(){this.conceptsPage++,this.getConcepts(this.searchKeyword||"")},editAdvanceSearch:function(){this.$refs.advancedSearchRef.openAdvancedSearch("edit",this.advanceSearchOriginalQuery,this.advanceSearchQuery)},openAdvanceSearch:function(){"quick"===this.searchType?this.$refs.advancedSearchRef.openAdvancedSearch("new"):(this.searchType="quick",this.queryString="",this.formData.patientList="",this.formData.beginTime="",this.formData.endTime="",this.phenotypeList=[],this.searchConditionList=[])},getPatientList:function(e){var t=this;this.patientListLoading=!0;var a={page:1,size:10},n={name:e};Object(g["c"])(n,a).then((function(e){200===e.code?(t.patientsOptions=e.data.content,t.patientListLoading=!1):(t.$message.error(e.message),t.patientListLoading=!1)}))},loadSearchContent:function(){var e=this;this.formData.keyword.trim()&&Object(r["a"])((function(){e.searchVisible=!0,e.popvoerTriggerStatus=!1,e.historyStatus=!1,e.conceptData=[],e.allSynonym=!1,e.sunonymData=[],e.conceptsPage=0,e.checkList=[],e.sunonymCustom="",e.tagEdit=!1,e.historyShowStatus=!1,e.getSunonym(),e.getConcepts()}),700)},getSunonym:function(e){var t=this,a={key:e||this.formData.keyword.trim()};this.sunonymLoading=!0,Object(g["d"])(a).then((function(a){if(a.data.length>0){var n=[];a.data[0].synonym.length>0&&(n=n.concat(a.data[0].synonym)),t.sunonymData=n}else t.sunonymData=[];if(t.sunonymLoading=!1,e){var s=[];t.searchConditionList.map((function(a){e===a.nestQuery.items[0].properties.text&&(t.checkList=a.nestQuery.items[0].synonym)}));var i=[];t.checkList.map((function(e){-1===t.sunonymData.indexOf(e)?s.push(e):i.push(e)})),i.length===t.sunonymData.length?t.allSynonym=!0:t.allSynonym=!1,t.sunonymCustom=s.join("\n")}}))},getConcepts:function(e){var t=this,a={from:this.conceptsPage,size:20};this.conceptsLoading=!0,Object(g["b"])(e||this.formData.keyword.trim(),a).then((function(a){var n=a.data.res;n.map((function(e){e.childChecked=!1,t.conceptData.push(e)})),t.conceptsLoading=!1,t.tagEdit&&t.searchConditionList.map((function(a){if(e===a.nestQuery.items[0].properties.text){var n=a.nestQuery.items[1].concepts;n.map((function(e){t.conceptData.map((function(t){e.code===t.conceptId&&e.sonsFlag&&(t.childChecked=!0)}))})),t.$nextTick((function(){t.$refs.conceptTree.setCheckedKeys(n.map((function(e){return e.code})))}))}}))})).catch((function(){t.conceptsLoading=!1}))}}},me=he,ye=(a("39d2"),Object(C["a"])(me,i,o,!1,null,null,null)),fe=ye.exports,ve=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"mt-20 vital-container"},[a("nav",{staticClass:"cb"},[a("strong",{staticClass:"fl nav-title mt-5 f16"},[e._v("Search Result")]),e._v(" "),a("strong",{staticClass:"fr"},[a("el-button",{attrs:{type:"primary",round:"",disabled:0===e.total,plain:"",icon:"el-icon-upload"},on:{click:e.openSavePatientList}},[e._v("Save")])],1)]),e._v(" "),a("section",{staticClass:"mt-20"},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.tableLoading,expression:"tableLoading"}],staticStyle:{width:"100%"},attrs:{data:e.tableData,"row-class-name":e.tableRowClassName},on:{"row-click":e.viewDetail}},[a("no-data-table",{attrs:{slot:"empty"},slot:"empty"}),e._v(" "),a("el-table-column",{attrs:{label:"PatientID",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n          "+e._s(t.row.key)+"\n        ")]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"name",label:"Name",width:"220"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n          "+e._s(t.row.firstName+" "+t.row.lastName)+"\n        ")]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"gender",label:"Gender",width:"90"}}),e._v(" "),a("el-table-column",{attrs:{prop:"dob",label:"DOB","min-width":"100"}}),e._v(" "),e._l(e.phenoTypeHeader,(function(t,n){return a("el-table-column",{key:n,staticClass:"color-main",attrs:{prop:t,label:t,align:"center",width:"120"},scopedSlots:e._u([{key:"default",fn:function(n){return[a("strong",{staticClass:"color-main"},[e._v(e._s(n.row[t]))])]}}],null,!0)})})),e._v(" "),a("el-table-column",{attrs:{align:"center",label:"Hits",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("strong",{staticClass:"color-main"},[e._v(e._s(t.row.total?t.row.total:0))]),e._v("\n          / "+e._s(+t.row.totalDocs?t.row.totalDocs:0)+"\n        ")]}}])})],2),e._v(" "),a("div",{staticClass:"tr mt-20"},[a("el-pagination",{attrs:{background:"","hide-on-single-page":"",layout:"total,prev, pager, next, jumper","current-page":e.page,total:e.total},on:{"current-change":e.handleCurrentChange}})],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"Save",visible:e.dialogVisible,width:"40%"},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("section",[a("el-form",{ref:"formData",attrs:{"label-position":"top",prop:"patientListName","label-width":"80px",model:e.formData}},[a("el-form-item",{attrs:{label:"Patient List Name：",prop:"patientListName"}},[a("el-input",{staticClass:"radius-input",attrs:{placeholder:"Please enter",disabled:e.patientDisable},model:{value:e.formData.patientListName,callback:function(t){e.$set(e.formData,"patientListName",t)},expression:"formData.patientListName"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"Phenotype Name：",prop:"phenotypeName"}},[a("el-input",{staticClass:"radius-input",attrs:{placeholder:"Please enter"},model:{value:e.formData.phenotypeName,callback:function(t){e.$set(e.formData,"phenotypeName",t)},expression:"formData.phenotypeName"}})],1),e._v(" "),a("el-checkbox",{staticClass:"mt-15 mb-20",attrs:{disabled:!e.formData.patientListName||!e.formData.phenotypeName},model:{value:e.formData.linkPhenotype,callback:function(t){e.$set(e.formData,"linkPhenotype",t)},expression:"formData.linkPhenotype"}},[a("strong",[e._v("\n          Do you want to link the phenotype to current patient list?")])])],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{round:""},on:{click:function(t){e.dialogVisible=!1}}},[e._v("Cancel")]),e._v(" "),a("el-button",{attrs:{loading:e.saveLoaing,round:"",type:"primary"},on:{click:e.savePatientList}},[e._v("Comfirm")])],1)])],1)},ge=[],De={components:{},props:{},data:function(){return{tableData:[],searchParams:{},searchType:"normal",tableLoading:!1,page:1,total:0,patientSize:10,dialogVisible:!1,patientDisable:!1,saveLoaing:!1,phenoTypeHeader:[],formData:{patientListName:"",phenotypeName:"",linkPhenotype:!1},saveFormData:{patientListNameChecked:!1,phenotypeNameChecked:!1}}},computed:{},watch:{"formData.phenotypeName":function(e,t){e&&this.formData.patientListName?e&&this.formData.patientListName&&(this.formData.linkPhenotype=!0):this.formData.linkPhenotype=!1},"formData.patientListName":function(e,t){e&&this.formData.phenotypeName?e&&this.formData.phenotypeName&&(this.formData.linkPhenotype=!0):this.formData.linkPhenotype=!1},$route:function(e,t){var a=this;"/"===e.path&&(G.$on("searchFunction",(function(e){a.page=1,a.searchParams=e,a.searchType="normal",sessionStorage.temporaryPatientListId="",a.handleSearch()})),G.$on("searchPhenoTypeFunction",(function(e){a.page=1,a.searchParams=e,a.searchType="phenotype",sessionStorage.temporaryPatientListId="",a.handleSearch()})))}},created:function(){},mounted:function(){var e=this;G.$on("searchFunction",(function(t){e.page=1,e.searchParams=t,e.searchType="normal",sessionStorage.temporaryPatientListId="",e.handleSearch()})),G.$on("searchPhenoTypeFunction",(function(t){e.page=1,e.searchParams=t,e.searchType="phenotype",sessionStorage.temporaryPatientListId="",e.handleSearch()}))},beforeDestroy:function(){G.$off("searchFunction"),G.$off("searchPhenoTypeFunction")},methods:{tableRowClassName:function(e){var t=e.row,a=e.rowIndex;t.index=a},viewDetail:function(e,t,a){var n=e.index+1+(this.page-1)*this.patientSize;if(this.searchParams.query){var s=this.searchParams.sdate?ae()(this.searchParams.sdate).format("YYYY-MM-DD"):"",i=this.searchParams.edate?ae()(this.searchParams.edate).format("YYYY-MM-DD"):"",o={query:this.searchParams.query,sdate:s,edate:i};sessionStorage.searchParams=JSON.stringify(o),sessionStorage.patientDetail=JSON.stringify(e),this.$router.push({path:"/patientDetail",query:{patientId:e.key,patientIndex:n,totalNum:this.total}})}else sessionStorage.patientDetail=JSON.stringify(e),this.$router.push({path:"/patientDetail",query:{patientId:e.key,patientListId:this.searchParams.patientListId,withPhenotype:!0,patientIndex:n,totalNum:this.total}})},openSavePatientList:function(){this.searchParams.query&&!this.searchParams.patientListId?(this.dialogVisible=!0,this.patientDisable=!1,this.formData.phenotypeName="",this.formData.patientListName="",this.formData.linkPhenotype=!1,sessionStorage.patientListId=""):this.searchParams.patientListId?this.searchParams.query.nestQuery.length>0?(this.dialogVisible=!0,this.patientDisable=!0,this.formData.phenotypeName="",this.formData.patientListName=this.searchParams.patientListName,sessionStorage.patientListId=this.searchParams.patientListId,this.formData.linkPhenotype=!1):this.$message.warning("Please enter search criteria."):this.$message.warning("Please search first.")},savePatientList:function(){var e=this;if(this.patientDisable&&!this.formData.phenotypeName)return this.$message.warning("Please enter phenotype name."),!1;if(this.formData.patientListName||this.formData.phenotypeName){var t=(this.searchParams.patientListId,{query:this.searchParams.query,sdate:this.searchParams.sdate,edate:this.searchParams.edate}),a={link:this.formData.linkPhenotype,patientList:{desc:"",name:this.formData.patientListName,type:"create",id:sessionStorage.patientListId?sessionStorage.patientListId:""},phenoType:{description:"",frontQuery:JSON.stringify(t),name:this.formData.phenotypeName,query:JSON.stringify(t),type:"create"},request:t,savePhenoType:!!this.formData.phenotypeName,savePatientList:!this.patientDisable&&!!this.formData.patientListName};this.saveLoaing=!0,Object(g["e"])(a).then((function(t){200===t.code&&(e.saveLoaing=!1,e.$message.success(t.message),e.dialogVisible=!1,sessionStorage.patientListId="",sessionStorage.temporaryPatientListId=t.data.id,G.$emit("refreshPatientList"))}))}else this.$message.warning("Please enter patient list name or phenotype name.")},handleCurrentChange:function(e){this.page=e,this.handleSearch()},handleSearch:function(){var e=this.searchParams;"normal"===this.searchType?e.patientPage=this.page:(e.patientPage=this.page,e.minDocCount=0),this.searchFunction(e)},searchFunction:function(e){var t=this;this.tableLoading=!0,"normal"===this.searchType?Object(g["f"])(e).then((function(e){if(200===e.code){var a=e.data;if(t.phenoTypeHeader=[],0!==a.total){var n=Object.values(a.aggs.agg),s=[];n.map((function(e){e.props&&e.result&&s.push(Object.assign({},e.props,{key:e.key},{total:e.result.total},0!==e.result.hits.length?e.result.hits[Object.keys(e.result.hits)[0]]:{}))})),t.tableData=s,t.total=a.aggs.total}else t.$message.warning("No data."),t.tableData=[],t.total=0;t.tableLoading=!1,G.$emit("endSearch")}else t.$message.error(e.message),t.tableLoading=!1,t.tableLoading=!1,t.tableData=[],t.total=0,G.$emit("endSearch")})).catch((function(e){t.tableLoading=!1})):Object(g["g"])(e).then((function(e){if(200===e.code){var a=e.data;if(0!==a.total){t.phenoTypeHeader=a.shownPheno;var n=Object.values(a.aggs.agg),s=[];n.map((function(e){e.props&&e.result&&s.push(Object.assign({},e.props,{total:e.result.total},{key:e.key},0!==e.result.hits.length?e.result.hits[Object.keys(e.result.hits)[0]]:{}))})),t.tableData=s,t.total=a.aggs.total}else t.$message.warning("No data."),t.tableData=[],t.total=0;t.tableLoading=!1,G.$emit("endSearch",t.total)}else t.$message.error(e.message),t.tableLoading=!1,G.$emit("endSearch")}))}}},be=De,Ce=Object(C["a"])(be,ve,ge,!1,null,"30645303",null),Se=Ce.exports,we={name:"Search",components:{searchHeader:fe,searchResult:Se},props:{},data:function(){return{}},computed:{},watch:{},created:function(){},mounted:function(){},methods:{}},Le=we,_e=Object(C["a"])(Le,n,s,!1,null,"4cc2d287",null);t["default"]=_e.exports},2839:function(e,t,a){"use strict";var n=a("f735"),s=a.n(n);s.a},3405:function(e,t,a){e.exports={menuText:"#bfcbd9",menuActiveText:"#727cf5",subMenuActiveText:"#f4f4f5",menuBg:"#fff",menuHover:"#eee",subMenuBg:"#fff",subMenuHover:"#eee",sideBarWidth:"210px",mainColor:"#727cf5"}},"34ac":function(e,t,a){"use strict";var n=a("463f"),s=a.n(n);s.a},"39d2":function(e,t,a){"use strict";var n=a("0531"),s=a.n(n);s.a},"463f":function(e,t,a){},4710:function(e,t,a){"use strict";var n=a("3405"),s=a.n(n);s.a},"6a28":function(e,t,a){"use strict";var n=a("c7ca"),s=a.n(n);s.a},"70cc":function(e,t,a){"use strict";a.d(t,"d",(function(){return s})),a.d(t,"b",(function(){return i})),a.d(t,"c",(function(){return o})),a.d(t,"f",(function(){return r})),a.d(t,"a",(function(){return c})),a.d(t,"e",(function(){return l})),a.d(t,"g",(function(){return d}));var n=a("b775");function s(e){return Object(n["a"])({url:"api/search/synonyms",method:"POST",params:e})}function i(e,t){return Object(n["a"])({url:"api/concept/".concat(e),method:"GET",params:t})}function o(e,t){return Object(n["a"])({url:"api/patientList/".concat(t.page,"/").concat(t.size),method:"POST",data:e})}function r(e){return Object(n["a"])({url:"api/search/nestQueryAgg",method:"POST",data:e})}function c(e){return Object(n["a"])({url:"api/concept/child/".concat(e,"/0/1000"),method:"get"})}function l(e){return Object(n["a"])({url:"/api/patientList/createPatientList",method:"POST",data:e})}function d(e){return Object(n["a"])({url:"/api/search/phenotypeSearch",method:"POST",data:e})}},ba0e:function(e,t,a){"use strict";var n=a("e06b"),s=a.n(n);s.a},c7ca:function(e,t,a){},e06b:function(e,t,a){},ef87:function(e,t,a){"use strict";function n(e){return n="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}a.d(t,"b",(function(){return s})),a.d(t,"d",(function(){return i})),a.d(t,"c",(function(){return o})),a.d(t,"a",(function(){return r}));var s=function e(t){if(Array.isArray(t))return t.map(e);if(t&&"object"===n(t)){for(var a={},s=Object.keys(t),i=0,o=s.length;i<o;i++){var r=s[i];a[r]=e(t[r])}return a}return t},i=function(e){if(Array.isArray(e))return Array.from(new Set(e))},o=function(e){var t=[],a=[];for(var n in e)t.push(n),a.push(e[n]);for(var s=0,i=a.length;s<i;s++)for(var o=0;o<i-s;o++){var r,c;a[o]<a[o+1]&&(c=a[o],a[o]=a[o+1],a[o+1]=c,r=t[o],t[o]=t[o+1],t[o+1]=r)}for(var l={},d=0;d<a.length;d++)l[""+t[d]]=a[d];return l},r=function(){var e=0;return function(t,a){clearTimeout(e),e=setTimeout(t,a)}}()},f735:function(e,t,a){}}]);